import{d as w,e as p,f as k}from"./index-BgchkrXJ.js";import{d as L,r as i,E as n}from"./.pnpm-Mf6j6NBF.js";const _=L("fileListStore",()=>{const a=i(!1),t=i({surl:"",url:"",pwd:"",dir:"/",password:""}),o=i(null),m=()=>{const e=t.value.dir.split("/");e.pop();const r=e.join("/");return r===""?"/":r},l=i({sign:"",timestamp:0}),g=async()=>{try{a.value=!0;const e=await k({surl:t.value.surl,uk:s.value.uk,shareid:s.value.shareid,password:t.value.password});l.value.sign=e.data.sign,l.value.timestamp=e.data.timestamp,n.success("获取签名成功")}finally{a.value=!1}},d=async()=>{Date.now()/1e3-l.value.timestamp>250?(n.info("获取签名中"),await g()):n.success("签名未过期,无需更新")},f=async()=>{if(!(!o.value||!await o.value.validate()))try{u.value=[],a.value=!0;const e=await w(t.value);s.value=e.data,t.value.dir!=="/"&&s.value.list.unshift({category:-1,fs_id:0,isdir:1,local_ctime:0,local_mtime:0,server_ctime:0,server_mtime:0,size:0,md5:"",path:m(),server_filename:"..",dlink:""}),n.success("获取文件列表成功")}finally{a.value=!1,await d()}},s=i({uk:0,shareid:0,randsk:"",list:[]}),u=i([]),v=i([]);return{pending:a,fileList:s,getFileList:f,getFileListForm:t,getFileListFormRef:o,selectedRows:u,downloadLinks:v,getDownloadLinks:async e=>{const r=e?[e]:u.value.map(c=>c.fs_id);await d();try{a.value=!0;const c=await p({uk:s.value.uk,shareid:s.value.shareid,randsk:s.value.randsk,fs_ids:r,sign:l.value.sign,timestamp:l.value.timestamp,password:t.value.password});v.value=c.data,n.success("解析成功")}finally{a.value=!1}}}});export{_ as u};
