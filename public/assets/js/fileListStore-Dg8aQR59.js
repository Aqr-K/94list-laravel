import{e as h,f as k,h as y}from"./index-C4RPeEQy.js";import{d as F,r as s,E as o}from"./.pnpm-BPJ2h7HZ.js";const P=F("fileListStore",()=>{const a=s(!1),t=s({surl:"",url:"",pwd:"",dir:"/",password:""}),u=s(null),w=()=>{const e=t.value.dir.split("/");e.pop();const n=e.join("/");return n===""?"/":n},L=async()=>{if(!(!u.value||!await u.value.validate())){if(t.value.surl==="")return o.error("获取链接surl失败");try{r.value=[],a.value=!0;const e=await h(t.value);i.value=e.data,t.value.dir!=="/"&&i.value.list.unshift({category:-1,fs_id:0,isdir:1,local_ctime:0,local_mtime:0,server_ctime:0,server_mtime:0,size:0,md5:"",path:w(),server_filename:"..",dlink:""}),o.success("获取文件列表成功")}finally{a.value=!1}}},i=s({uk:0,shareid:0,randsk:"",list:[]}),r=s([]),f=s([]),p=async(e,n=!1)=>{const g=e?[e]:r.value.filter(l=>l.isdir!==1).map(l=>l.fs_id);e===void 0&&g.length!==r.value.length&&o.error("文件夹不会被解析!");let v;try{a.value=!0;const l={uk:i.value.uk,shareid:i.value.shareid,randsk:i.value.randsk,fs_ids:g,password:t.value.password};if(v=await k(l),o.success("解析成功"),n)f.value=v.data;else return a.value=!1,await d(),v.data}finally{a.value=!1,await d()}},m=s({group_name:"",count:0,size:0}),c=s(!1),d=async()=>{try{a.value=!0;const e=await y();m.value=e.data,c.value=!1}catch{c.value=!0}finally{a.value=!1}};return{pending:a,fileList:i,getFileList:L,getFileListForm:t,getFileListFormRef:u,selectedRows:r,downloadLinks:f,getDownloadLinks:p,limitForm:m,getLimit:d,hitLimit:c}});export{P as u};
