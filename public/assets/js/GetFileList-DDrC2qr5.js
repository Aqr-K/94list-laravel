import{b as X,r as $,N as z,o as Y,P as ee,E as R,n as te,w as le,u as t,e as i,c as p,m as a,q as g,t as v,C as c,j as L,x as y,k as r,F as D,Q as oe,y as se,z as ae,A as re,B as ne,p as ie,v as ue}from"./.pnpm-DQd76FlD.js";import{u as de}from"./fileListStore-CSCaqHJS.js";import{u as pe,a as me,g as N,c as ce}from"./index-CY8zHUnN.js";import{c as fe}from"./copy-CmnJBQmg.js";import{f as T}from"./format-DaCfCw6f.js";import{i as _e}from"./isMobile-BD0f7XPI.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ve={key:0},ye={key:1},ke=["src"],we=X({__name:"GetFileList",setup(be){const C=$("right");_e()&&(C.value="top");const k=de(),{pending:Z,getFileListForm:o,getFileListFormRef:M,selectedRows:I,limitForm:f,limitMessage:S,vcode:w,downloadLinks:P}=z(k),B=pe(),{config:_}=z(B),G=(l,e,n)=>e===""?n(new Error("请先输入需要解析的链接")):E(e)?n():n(new Error("请输入合法的链接")),q=()=>{o.value.dir="/",o.value.surl="";const l=E(o.value.url);l&&(l.id&&(l.surl?(o.value.url=`https://pan.baidu.com/share/init?surl=${l.id}`,o.value.surl=`1${l.id}`):(o.value.url=`https://pan.baidu.com/s/${l.id}`,o.value.surl=l.id)),l.pwd&&(o.value.pwd=l.pwd,R.success("已自动填写密码")))},E=l=>{const e=l.match(/s\/([a-zA-Z0-9_-]+)/),n=l.match(/surl=([a-zA-Z0-9_-]+)/),d=l.match(/\?pwd=([a-zA-Z0-9_-]+)/),u=l.match(/&pwd=([a-zA-Z0-9_-]+)/),m=l.match(/提取码[:：]\s?([a-zA-Z0-9_-]+)/);let b;if(n)b=n[1];else if(e)b=e[1];else return!1;const V=d?d[1]:u?u[1]:m?m[1]:null;return n?{surl:!0,id:b,pwd:V}:{id:b,pwd:V}},j={url:[{required:!0,validator:G,trigger:"blur"}]},Q=async l=>{if(!l||!await l.validate())return;const e=new URLSearchParams;e.set("url",o.value.url),e.set("surl",o.value.surl),e.set("pwd",o.value.pwd),e.set("dir",o.value.dir),fe(`${location.host}/?${e.toString()}`,"复制成功")};Y(()=>{ee(()=>{const l=new URLSearchParams(location.search);if(l.size<4)return;const e=l.get("url"),n=l.get("pwd"),d=l.get("dir"),u=l.get("surl");!e||!n||!d||!u||(o.value={url:e,pwd:n,dir:d,surl:u},R.success("已读取到参数,正在加载"),setTimeout(k.getFileList,500))}),k.getLimit(),A()});const U=te(),H=()=>U.push("/login"),J=()=>U.push("/admin"),K=l=>window.open(l),x=$(0),A=()=>x.value=Date.now(),h=()=>P.value=[],F=$(!1),O=()=>{o.value.token!==""?F.value=!0:F.value=!1,k.getLimit()};return(l,e)=>{const n=oe,d=se,u=ae,m=re,b=ne,V=ie,W=ue;return le((i(),p(V,null,{default:a(()=>[g("h2",null,"前台解析中心 | "+v(t(me)()),1),t(_).show_copyright?(i(),p(n,{key:0,"show-icon":"",type:"warning",closable:!1,title:t(_).custom_copyright},null,8,["title"])):c("",!0),t(_).have_account?(i(),p(n,{key:1,closable:!1,class:"alert",title:"当前中转账号充足",type:"success"})):(i(),p(n,{key:2,closable:!1,class:"alert",title:"当前中转账号不足",type:"error"})),t(_).debug?(i(),p(n,{key:3,class:"alert",title:"当前网站开启了DEBUG模式,非调试请关闭!!!!",type:"error",closable:!1})):c("",!0),t(_).is_https?c("",!0):(i(),p(n,{key:4,class:"alert",title:"当前网站未开启SSL,可能出现无法请求Aria2服务器的问题",type:"error",closable:!1})),t(S)===""?(i(),p(n,{key:5,class:"alert",type:"success",closable:!1},{default:a(()=>[F.value?(i(),L("span",ve,[g("span",null,"当前卡密: "+v(t(f).group_name),1),g("span",null,"剩余可解析文件数: "+v(t(f).count),1),g("span",null,"剩余可解析大小: "+v(t(T)(t(f).size)),1),g("span",null," 到期时间: "+v(t(f).expired_at==="未使用"?t(f).expired_at:new Date(t(f).expired_at??0).toLocaleString()),1)])):(i(),L("span",ye,[g("span",null,"当前用户组: "+v(t(f).group_name),1),g("span",null,"剩余可解析文件数: "+v(t(f).count),1),g("span",null,"剩余可解析大小: "+v(t(T)(t(f).size)),1)]))]),_:1})):(i(),p(n,{key:6,class:"alert",type:"error",closable:!1},{default:a(()=>[y(v(t(S)??"未知错误"),1)]),_:1})),r(b,{ref_key:"getFileListFormRef",ref:M,model:t(o),rules:j,"label-width":"auto",class:"form","label-position":C.value},{default:a(()=>[r(u,{label:"链接",prop:"url"},{default:a(()=>[r(d,{modelValue:t(o).url,"onUpdate:modelValue":e[0]||(e[0]=s=>t(o).url=s),modelModifiers:{trim:!0},onChange:e[1]||(e[1]=s=>h()),onBlur:e[2]||(e[2]=s=>q())},null,8,["modelValue"])]),_:1}),r(u,{label:"密码",prop:"pwd"},{default:a(()=>[r(d,{modelValue:t(o).pwd,"onUpdate:modelValue":e[3]||(e[3]=s=>t(o).pwd=s),modelModifiers:{trim:!0},onChange:e[4]||(e[4]=s=>h())},null,8,["modelValue"])]),_:1}),t(_).need_password?(i(),p(u,{key:0,label:"解析密码",prop:"password"},{default:a(()=>[r(d,{modelValue:t(o).password,"onUpdate:modelValue":e[5]||(e[5]=s=>t(o).password=s),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1})):c("",!0),t(_).token_mode?(i(),p(u,{key:1,label:"卡密(不用留空即可)",prop:"token"},{default:a(()=>[r(d,{modelValue:t(o).token,"onUpdate:modelValue":e[6]||(e[6]=s=>t(o).token=s),modelModifiers:{trim:!0},onBlur:O},null,8,["modelValue"])]),_:1})):c("",!0),r(u,{label:"当前路径",prop:"dir"},{default:a(()=>[r(d,{modelValue:t(o).dir,"onUpdate:modelValue":e[7]||(e[7]=s=>t(o).dir=s),disabled:""},null,8,["modelValue"])]),_:1}),t(w).hit_captcha?(i(),L(D,{key:2},[r(u,{label:"验证码编号",prop:"vcode_str"},{default:a(()=>[r(d,{modelValue:t(w).vcode_str,"onUpdate:modelValue":e[8]||(e[8]=s=>t(w).vcode_str=s),disabled:""},null,8,["modelValue"])]),_:1}),r(u,{label:"验证码图片",prop:"vcode_img"},{default:a(()=>[g("img",{src:`${t(w).vcode_img}&t=${x.value}`,alt:"验证码图片",onClick:A},null,8,ke)]),_:1}),r(u,{label:"验证码字符",prop:"vcode_input"},{default:a(()=>[r(d,{modelValue:t(w).vcode_input,"onUpdate:modelValue":e[9]||(e[9]=s=>t(w).vcode_input=s)},null,8,["modelValue"])]),_:1})],64)):c("",!0),r(u,{label:" ",class:"buttons"},{default:a(()=>[r(m,{type:"primary",onClick:e[10]||(e[10]=s=>t(k).getFileList())},{default:a(()=>[y("获取/刷新列表")]),_:1}),r(m,{type:"primary",disabled:t(I).length<=0,onClick:e[11]||(e[11]=s=>t(k).getDownloadLinks())},{default:a(()=>[y(" 批量解析 ")]),_:1},8,["disabled"]),r(m,{type:"primary",onClick:e[12]||(e[12]=s=>Q(t(M)))},{default:a(()=>[y("复制当前地址")]),_:1}),t(_).button_link!==""?(i(),p(m,{key:0,type:"primary",onClick:e[13]||(e[13]=s=>K(t(_).button_link))},{default:a(()=>[y(" 前往购买卡密 ")]),_:1})):c("",!0),t(N)()==="0"?(i(),p(m,{key:1,type:"primary",onClick:e[14]||(e[14]=s=>H())},{default:a(()=>[y("登陆")]),_:1})):c("",!0),t(N)()==="1"?(i(),L(D,{key:2},[t(ce)()==="admin"?(i(),p(m,{key:0,type:"primary",onClick:e[15]||(e[15]=s=>J())},{default:a(()=>[y(" 进入后台 ")]),_:1})):c("",!0),r(m,{type:"danger",onClick:e[16]||(e[16]=s=>t(B).logout())},{default:a(()=>[y(" 注销 ")]),_:1})],64)):c("",!0)]),_:1})]),_:1},8,["model","label-position"])]),_:1})),[[W,t(Z)]])}}}),Be=ge(we,[["__scopeId","data-v-54e35db6"]]);export{Be as default};
