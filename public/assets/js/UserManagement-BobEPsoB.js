import"./base-FFb6ABGl.js";import{v as T}from"./el-loading-SJb1wJ0I.js";import{E as Y}from"./el-pagination-DhyZ3Pix.js";import{E as q}from"./el-input-Bv-ge0Tw.js";import"./el-tag-BVQKBKaP.js";import{E as G,a as K}from"./el-select-DFdNTH-N.js";import{E as Z,a as h}from"./el-table-column-Bh2DaO32.js";import{E as j}from"./el-button-C33TVszl.js";import{aa as w,d as H,aK as ee,aL as ae,r as f,o as V,e as S,f as l,a,k as _,w as c,c as A,F as N,aE as J,E as M,O as le,i as D,t as z,a4 as U,n as R}from"./index-q5nPSmrO.js";import{E as te}from"./el-overlay-DjMvTPRT.js";import{E as oe,a as se}from"./el-form-item-kKOb3mX2.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-_lCbC3W8.js";import"./use-form-item-DBXySpCx.js";import"./focus-trap-beDooJ_E.js";import"./AdminView-Cx_PMT9q.js";import"./el-card-DlDoXJKb.js";import"./user-DFWkiVqt.js";import"./vnode-CdbOpZ1J.js";import"./scroll-6LIW_9_V.js";const de=n=>w.post("/admin/user",n),ue=n=>w.get(`/admin/user?page=${n.page}&size=${n.size}`),re=n=>w.patch(`/admin/user/${n.id}`,n),ie=n=>w.delete(`/admin/user/${n.id}`),pe=n=>w.delete("/admin/user",{data:{user_ids:n}}),me=H({__name:"AddUser",props:{modelValue:{},modelModifiers:{}},emits:ee(["getUsers"],["update:modelValue"]),setup(n,{emit:i}){const k=i,y=ae(n,"modelValue"),b=f(!1),d=f({username:"",password:"",role:"user",group_id:void 0}),p=f(null),x={username:[{required:!0,message:"请输入账户用户名",trigger:"blur"}],password:[{required:!0,message:"请输入账户密码",trigger:"blur"}]},F=async E=>{if(!(!E||!await E.validate()))try{b.value=!0,await de(d.value),M.success("添加成功")}finally{b.value=!1}},I=E=>{k("getUsers"),E()},L=()=>{y.value=!1,k("getUsers")};return(E,s)=>{const v=q,C=oe,t=G,m=K,g=se,r=j,$=te,B=T;return V(),S($,{title:"添加用户",width:"60%",modelValue:y.value,"onUpdate:modelValue":s[6]||(s[6]=o=>y.value=o),"before-close":I},{footer:l(()=>[a(r,{type:"info",onClick:s[4]||(s[4]=o=>L())},{default:l(()=>[_("取消")]),_:1}),a(r,{type:"primary",onClick:s[5]||(s[5]=o=>F(p.value))},{default:l(()=>[_("添加")]),_:1})]),default:l(()=>[c((V(),S(g,{ref_key:"addUserFormRef",ref:p,model:d.value,rules:x,"label-width":"auto"},{default:l(()=>[a(C,{label:"用户名",prop:"username"},{default:l(()=>[a(v,{modelValue:d.value.username,"onUpdate:modelValue":s[0]||(s[0]=o=>d.value.username=o)},null,8,["modelValue"])]),_:1}),a(C,{label:"密码",prop:"password"},{default:l(()=>[a(v,{modelValue:d.value.password,"onUpdate:modelValue":s[1]||(s[1]=o=>d.value.password=o)},null,8,["modelValue"])]),_:1}),a(C,{label:"权限",prop:"role"},{default:l(()=>[a(m,{modelValue:d.value.role,"onUpdate:modelValue":s[2]||(s[2]=o=>d.value.role=o)},{default:l(()=>[(V(),A(N,null,J(["user","admin"],o=>a(t,{key:o,label:o,value:o},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(C,{label:"用户组ID",prop:"group_id"},{default:l(()=>[a(v,{modelValue:d.value.group_id,"onUpdate:modelValue":s[3]||(s[3]=o=>d.value.group_id=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[B,b.value]])]),_:1},8,["modelValue"])}}}),ce=H({__name:"UserManagement",setup(n){const i=f(!1),k=f(15),y=f(1),b=f(),d=f([]),p=async()=>{try{i.value=!0;const t=await ue({page:y.value,size:k.value});b.value=t.data}finally{i.value=!1}},x=async t=>{t.edit=!(t.edit??!1)},F=async t=>{t.edit=!(t.edit??!0),await I(t)},I=async t=>{try{i.value=!0,await re(t),M.success("修改用户成功")}finally{i.value=!1,await p()}},L=async t=>{try{i.value=!0,await ie(t),M.success("删除用户成功")}finally{i.value=!1,await p()}},E=async()=>{try{i.value=!0;const t=d.value.map(m=>m.id);await pe(t),M.success("批量删除用户成功")}finally{i.value=!1,await p()}},s=t=>d.value=t;le(p);const v=f(!1),C=()=>v.value=!v.value;return(t,m)=>{var O,P;const g=j,r=Z,$=q,B=G,o=K,Q=h,W=Y,X=T;return V(),A(N,null,[a(me,{onGetUsers:p,modelValue:v.value,"onUpdate:modelValue":m[0]||(m[0]=e=>v.value=e)},null,8,["modelValue"]),a(g,{type:"primary",onClick:p},{default:l(()=>[_("刷新列表")]),_:1}),a(g,{type:"primary",onClick:C},{default:l(()=>[_("添加用户")]),_:1}),a(g,{type:"danger",disabled:d.value.length<=0,onClick:E},{default:l(()=>[_(" 批量删除 ")]),_:1},8,["disabled"]),c((V(),S(Q,{data:((O=b.value)==null?void 0:O.data)??[],border:"","show-overflow-tooltip":"",class:"table",onSelectionChange:s},{default:l(()=>[a(r,{type:"selection",width:"40"}),a(r,{prop:"id",label:"ID"}),a(r,{prop:"group_id",label:"用户组ID"},{default:l(({row:e})=>[c(D("span",null,z(e.group_id),513),[[U,!e.edit]]),c(a($,{modelValue:e.group_id,"onUpdate:modelValue":u=>e.group_id=u},null,8,["modelValue","onUpdate:modelValue"]),[[U,e.edit]])]),_:1}),a(r,{prop:"inv_code_id",label:"邀请码ID"}),a(r,{prop:"username",label:"用户名"},{default:l(({row:e})=>[c(D("span",null,z(e.username),513),[[U,!e.edit]]),c(a($,{modelValue:e.username,"onUpdate:modelValue":u=>e.username=u},null,8,["modelValue","onUpdate:modelValue"]),[[U,e.edit]])]),_:1}),a(r,{prop:"password",label:"密码"},{default:l(({row:e})=>[c(D("span",null,z(e.password),513),[[U,!e.edit]]),c(a($,{modelValue:e.password,"onUpdate:modelValue":u=>e.password=u},null,8,["modelValue","onUpdate:modelValue"]),[[U,e.edit]])]),_:1}),a(r,{prop:"role",label:"权限"},{default:l(({row:e})=>[c(D("span",null,z(e.role),513),[[U,!e.edit]]),c(a(o,{modelValue:e.role,"onUpdate:modelValue":u=>e.role=u},{default:l(()=>[(V(),A(N,null,J(["user","admin"],u=>a(B,{key:u,label:u,value:u},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"]),[[U,e.edit]])]),_:1}),a(r,{prop:"created_at",label:"创建时间"},{default:l(({row:e})=>[_(z(new Date(e.created_at).toLocaleString()),1)]),_:1}),a(r,{prop:"updated_at",label:"更新时间"},{default:l(({row:e})=>[_(z(new Date(e.updated_at).toLocaleString()),1)]),_:1}),a(r,{width:"150",label:"操作",fixed:"right"},{default:l(({row:e})=>[e.edit?R("",!0):(V(),S(g,{key:0,size:"small",type:"primary",onClick:u=>x(e)},{default:l(()=>[_(" 编辑 ")]),_:2},1032,["onClick"])),e.edit?(V(),S(g,{key:1,size:"small",type:"primary",onClick:u=>F(e)},{default:l(()=>[_(" 保存 ")]),_:2},1032,["onClick"])):R("",!0),a(g,{size:"small",type:"danger",onClick:u=>L(e)},{default:l(()=>[_("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[X,i.value]]),a(W,{"current-page":y.value,"onUpdate:currentPage":m[1]||(m[1]=e=>y.value=e),"page-size":k.value,"onUpdate:pageSize":m[2]||(m[2]=e=>k.value=e),"page-sizes":[15,30,50,100],total:((P=b.value)==null?void 0:P.total)??100,layout:"sizes, prev, pager, next",onSizeChange:p,onCurrentChange:p},null,8,["current-page","page-size","total"])],64)}}}),Le=ne(ce,[["__scopeId","data-v-dddccf5c"]]);export{Le as default};
