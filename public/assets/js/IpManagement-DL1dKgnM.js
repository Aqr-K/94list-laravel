import"./base-DzfnSdGl.js";import{v as j}from"./el-loading-Dqc-yn7H.js";import{E as h}from"./el-pagination-DwvF7Wex.js";import{E as q}from"./el-input-BEQYXOrs.js";import"./el-tag-CUh0AjBU.js";import{E as H,a as J}from"./el-select-CZZ_1tAL.js";import{E as ee,a as te}from"./el-table-column-BcnOE-AB.js";import{E as Q}from"./el-button-DtYNY52B.js";import{aa as C,d as W,aK as ae,aL as le,r as m,o as v,e as A,f as l,a as t,k as u,w as E,c as B,F as R,aE as X,E as b,O as oe,i as G,t as z,a4 as S,n as K}from"./index-niWMSR8p.js";import{E as ne}from"./el-overlay-3YP-gJF7.js";import{E as se,a as ie}from"./el-form-item-Ct3QjCMy.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-Bbp7VP7R.js";import"./use-form-item-DsYTp4Yb.js";import"./focus-trap-CVuM4905.js";import"./AdminView-Cgf6NGdE.js";import"./el-card-D0AZMfBh.js";import"./user-Cd5hS_vJ.js";import"./vnode-CSQD_1u2.js";import"./scroll-DGkImYz_.js";const pe=n=>C.post("/admin/ip",n),ue=n=>C.get(`/admin/ip?page=${n.page}&size=${n.size}`),re=n=>C.patch(`/admin/ip/${n.id}`,n),me=n=>C.delete("/admin/ip",{data:{ip_ids:[n.id]}}),ce=n=>C.delete("/admin/ip",{data:{ip_ids:n}}),fe=/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,_e=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))/,Y=n=>fe.test(n)||_e.test(n),ve=W({__name:"AddIp",props:{modelValue:{},modelModifiers:{}},emits:ae(["getIps"],["update:modelValue"]),setup(n,{emit:d}){const V=d,g=le(n,"modelValue"),I=m(!1),F=(c,o,y)=>{if(!o)return y(new Error("请输入IP地址"));Y(o)?y():y(new Error("请输入有效的IP地址"))},i=m({ip:"",mode:0}),k=m(null),U={ip:[{validator:F,message:"请输入IP",trigger:"blur"}]},w=async c=>{if(!(!c||!await c.validate()))try{I.value=!0,await pe(i.value),b.success("添加成功")}finally{I.value=!1}},M=c=>{V("getIps"),c()},x=()=>{g.value=!1,V("getIps")};return(c,o)=>{const y=q,a=se,s=H,f=J,r=ie,$=Q,D=ne,L=j;return v(),A(D,{title:"添加IP",width:"60%",modelValue:g.value,"onUpdate:modelValue":o[4]||(o[4]=p=>g.value=p),"before-close":M},{footer:l(()=>[t($,{type:"info",onClick:o[2]||(o[2]=p=>x())},{default:l(()=>[u("取消")]),_:1}),t($,{type:"primary",onClick:o[3]||(o[3]=p=>w(k.value))},{default:l(()=>[u("添加")]),_:1})]),default:l(()=>[E((v(),A(r,{ref_key:"addIpFormRef",ref:k,model:i.value,rules:U,"label-width":"auto"},{default:l(()=>[t(a,{label:"IP",prop:"ip"},{default:l(()=>[t(y,{modelValue:i.value.ip,"onUpdate:modelValue":o[0]||(o[0]=p=>i.value.ip=p)},null,8,["modelValue"])]),_:1}),t(a,{label:"模式",prop:"mode"},{default:l(()=>[t(f,{modelValue:i.value.mode,"onUpdate:modelValue":o[1]||(o[1]=p=>i.value.mode=p)},{default:l(()=>[(v(),B(R,null,X(["黑名单","白名单"],(p,P)=>t(s,{key:P,label:p,value:P},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[L,I.value]])]),_:1},8,["modelValue"])}}}),ge=W({__name:"IpManagement",setup(n){const d=m(!1),V=m(15),g=m(1),I=m(),F=m([]),i=async()=>{try{d.value=!0;const a=await ue({page:g.value,size:V.value});I.value=a.data}finally{d.value=!1}},k=async a=>{a.edit=!(a.edit??!1)},U=async a=>{if(!Y(a.ip))return b.error("请输入正确的IP");a.edit=!(a.edit??!0),await w(a)},w=async a=>{try{d.value=!0,await re(a),b.success("修改IP成功")}finally{d.value=!1,await i()}},M=async a=>{try{d.value=!0,await me(a),b.success("删除IP成功")}finally{d.value=!1,await i()}},x=async()=>{try{d.value=!0;const a=F.value.map(s=>s.id);await ce(a),b.success("批量删除IP成功")}finally{d.value=!1,await i()}},c=a=>F.value=a;oe(i);const o=m(!1),y=()=>o.value=!o.value;return(a,s)=>{var N,O;const f=Q,r=ee,$=q,D=H,L=J,p=te,P=h,Z=j;return v(),B(R,null,[t(ve,{onGetIps:i,modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=e=>o.value=e)},null,8,["modelValue"]),t(f,{type:"primary",onClick:s[1]||(s[1]=e=>i())},{default:l(()=>[u("刷新列表")]),_:1}),t(f,{type:"primary",onClick:s[2]||(s[2]=e=>y())},{default:l(()=>[u("添加IP")]),_:1}),t(f,{type:"danger",disabled:F.value.length<=0,onClick:s[3]||(s[3]=e=>x())},{default:l(()=>[u(" 批量删除 ")]),_:1},8,["disabled"]),E((v(),A(p,{data:((N=I.value)==null?void 0:N.data)??[],border:"","show-overflow-tooltip":"",class:"table",onSelectionChange:c},{default:l(()=>[t(r,{type:"selection",width:"40"}),t(r,{prop:"id",label:"ID"}),t(r,{prop:"ip",label:"IP"},{default:l(({row:e})=>[E(G("span",null,z(e.ip),513),[[S,!e.edit]]),E(t($,{modelValue:e.ip,"onUpdate:modelValue":_=>e.ip=_},null,8,["modelValue","onUpdate:modelValue"]),[[S,e.edit]])]),_:1}),t(r,{prop:"mode",label:"模式"},{default:l(({row:e})=>[E(G("span",null,z(e.mode?"白名单":"黑名单"),513),[[S,!e.edit]]),E(t(L,{modelValue:e.mode,"onUpdate:modelValue":_=>e.mode=_},{default:l(()=>[(v(),B(R,null,X(["黑名单","白名单"],(_,T)=>t(D,{key:T,label:_,value:T},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"]),[[S,e.edit]])]),_:1}),t(r,{prop:"created_at",label:"创建时间"},{default:l(({row:e})=>[u(z(new Date(e.created_at).toLocaleString()),1)]),_:1}),t(r,{prop:"updated_at",label:"更新时间"},{default:l(({row:e})=>[u(z(new Date(e.updated_at).toLocaleString()),1)]),_:1}),t(r,{width:"150",label:"操作",fixed:"right"},{default:l(({row:e})=>[e.edit?K("",!0):(v(),A(f,{key:0,size:"small",type:"primary",onClick:_=>k(e)},{default:l(()=>[u(" 编辑 ")]),_:2},1032,["onClick"])),e.edit?(v(),A(f,{key:1,size:"small",type:"primary",onClick:_=>U(e)},{default:l(()=>[u(" 保存 ")]),_:2},1032,["onClick"])):K("",!0),t(f,{size:"small",type:"danger",onClick:_=>M(e)},{default:l(()=>[u("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,d.value]]),t(P,{"current-page":g.value,"onUpdate:currentPage":s[4]||(s[4]=e=>g.value=e),"page-size":V.value,"onUpdate:pageSize":s[5]||(s[5]=e=>V.value=e),"page-sizes":[15,30,50,100],total:((O=I.value)==null?void 0:O.total)??100,layout:"sizes, prev, pager, next",onSizeChange:i,onCurrentChange:i},null,8,["current-page","page-size","total"])],64)}}}),Re=de(ge,[["__scopeId","data-v-1c4d83a8"]]);export{Re as default};
