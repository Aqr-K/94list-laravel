import{d as V,r as t,l as T,s as D,a as j,o as I,c as U,b as f,u as g,F as x,e as G,f as v,_}from"./index-5feb174a.js";import{d as M,a as N,b as z,c as B}from"./user-8f13264d.js";import{E as r}from"./request-8bfac485.js";const q=V("UserPannel",()=>{const d=t({announce:"",announceSwitch:!1,debug:!1,haveAccount:!1,havePassword:!1,haveLogin:!1,userAgent:"",ishttps:document.location.protocol==="https:",pending:!1}),m=async()=>{d.value.pending=!0;const e=await M()??"failed";d.value.pending=!1,e.toString()!=="failed"&&(Object.assign(d.value,{...e.data,announce:e.data.announce.replace(/\[NextLine\]/g,"<br>")}),D(e.data.haveLogin?"1":"0"))},a=t({url:"",pwd:"",password:"",dir:"/",bd_user_id:null,pending:!1}),p=t(null),l=t([]),o=t({randsk:"",shareid:0,uk:0,sign:"",timestamp:0}),u=t([]),w=t(null),F=async(e,s)=>{a.value.dir=e,await h(s)},k=()=>{const e=a.value.dir.split("/");e.pop();const s=e.join("/");return s===""?"/":s},h=async(e="0",s=!1)=>{const i=await N({url:a.value.url,pwd:a.value.pwd,dir:a.value.dir,password:a.value.password})??"failed";if(i.toString()==="failed")return;const{message:c,data:n}=i;return r.success(c),Object.assign(o.value,{randsk:n.randsk,shareid:n.shareid,uk:n.uk}),l.value=n.list,a.value.dir!==null&&a.value.dir!==""&&a.value.dir!=="/"?l.value=[{isdir:"1",path:k(),server_filename:"..",size:"0",server_mtime:s?l.value[0].server_mtime:e},...n.list]:l.value=n.list,"success"},L=async()=>{const e=await z({uk:o.value.uk,shareid:o.value.shareid,password:a.value.password})??"failed";if(e.toString()==="failed")return;const{message:s,data:i}=e;r.success(s),Object.assign(o.value,i)},b=async e=>{const s=await B({fs_ids:Array.isArray(e)?e:[e],...o.value,password:a.value.password,bd_user_id:a.value.bd_user_id}).catch(async c=>{const{message:n}=c;n.includes("当前签名已过期")?(r.error(n),r.info("自动重新获取中..."),await P(p.value)):n.includes("您没有权限指定下载的用户")&&(D("0"),r.error("登陆已过期,请重新登陆"),location.reload())})??"failed";if(!s||s==="failed")return;const{data:i}=s;r.success("解析成功"),y.value=i,S.value=!0},P=async e=>{e&&await e.validate(()=>{})&&(a.value.pending=!0,await h("0",!0),await L(),a.value.pending=!1)},E=async()=>{a.value.pending=!0;let e=!1;if(u.value=u.value.filter(i=>{var n;if(e)return!1;const c=i.isdir=="1";return c&&(e=!0,r.error("暂不支持下载文件夹"),(n=w.value)==null||n.clearSelection()),!c}),e){a.value.pending=!1;return}const s=u.value.map(i=>i.fs_id);await b(s),a.value.pending=!1},y=t([]),S=t(!1),O=t([]),A=t(!1),C=t(T()),R=t(null);return{getConfig:m,getDir:F,getFileList:h,getFileSign:L,freshFileList:P,downloadFile:b,downloadFiles:E,clientConfig:d,getFileListForm:a,getFileListFormRef:p,filelist:l,requestParams:o,selectedRows:u,fileListTableRef:w,dlinkList:y,downloadDialogVisible:S,selectDownloadFiles:O,aria2ConfigForm:C,aria2ConfigDialogVisible:A,aria2ConfigFormRef:R,saveAria2Config:async e=>{e&&await e.validate(()=>{})&&(localStorage.setItem("aria2_config",JSON.stringify(C.value)),r.success("保存成功"),A.value=!1)}}}),J=j({__name:"UserPannel",setup(d){const m=v(()=>_(()=>import("./announceDialog-1baee520.js"),["assets/js/announceDialog-1baee520.js","assets/js/base-8da118dd.js","assets/js/request-8bfac485.js","assets/js/index-5feb174a.js","assets/css/index-e5387e95.css","assets/css/base-34dba8e3.css","assets/js/el-overlay-d91e9200.js","assets/js/vnode-94723534.js","assets/js/focus-trap-9497ed29.js","assets/js/isNil-c75b1b34.js","assets/js/scroll-b2773a8f.js","assets/js/index-183e2613.js","assets/css/el-overlay-49152403.css","assets/js/user-8f13264d.js"])),a=v(()=>_(()=>import("./getFileListForm-1bfd969b.js"),["assets/js/getFileListForm-1bfd969b.js","assets/js/base-8da118dd.js","assets/js/request-8bfac485.js","assets/js/index-5feb174a.js","assets/css/index-e5387e95.css","assets/css/base-34dba8e3.css","assets/js/el-loading-04f8397e.js","assets/css/el-loading-d0f2d079.css","assets/js/el-card-d7834fa9.js","assets/css/el-card-208b2445.css","assets/js/el-form-item-a5087132.js","assets/js/use-form-item-c4555cb1.js","assets/js/_initCloneObject-584d905d.js","assets/css/el-form-item-7d5af5e1.css","assets/js/el-button-c98be082.js","assets/js/index-183e2613.js","assets/css/el-button-2cb60ae5.css","assets/js/el-input-aab76947.js","assets/js/isNil-c75b1b34.js","assets/css/el-input-45b6b5ba.css","assets/js/copy-1adc0143.js","assets/js/_commonjsHelpers-725317a4.js","assets/js/user-8f13264d.js","assets/css/getFileListForm-5d45f733.css"])),p=v(()=>_(()=>import("./showFileList-12d79940.js"),["assets/js/showFileList-12d79940.js","assets/js/base-8da118dd.js","assets/js/request-8bfac485.js","assets/js/index-5feb174a.js","assets/css/index-e5387e95.css","assets/css/base-34dba8e3.css","assets/js/el-loading-04f8397e.js","assets/css/el-loading-d0f2d079.css","assets/js/el-card-d7834fa9.js","assets/css/el-card-208b2445.css","assets/js/el-table-column-247ad034.js","assets/js/el-popper-abfe5e73.js","assets/js/_initCloneObject-584d905d.js","assets/js/isNil-c75b1b34.js","assets/js/use-form-item-c4555cb1.js","assets/js/focus-trap-9497ed29.js","assets/css/el-popper-9e0bc416.css","assets/js/_commonjsHelpers-725317a4.js","assets/css/el-table-column-838a2945.css","assets/js/el-space-1dbc7e91.js","assets/js/vnode-94723534.js","assets/css/el-space-417b6673.css","assets/js/user-8f13264d.js"])),l=v(()=>_(()=>import("./downloadDialog-07bcac6c.js"),["assets/js/downloadDialog-07bcac6c.js","assets/js/base-8da118dd.js","assets/js/request-8bfac485.js","assets/js/index-5feb174a.js","assets/css/index-e5387e95.css","assets/css/base-34dba8e3.css","assets/js/el-overlay-d91e9200.js","assets/js/vnode-94723534.js","assets/js/focus-trap-9497ed29.js","assets/js/isNil-c75b1b34.js","assets/js/scroll-b2773a8f.js","assets/js/index-183e2613.js","assets/css/el-overlay-49152403.css","assets/js/el-table-column-247ad034.js","assets/js/el-popper-abfe5e73.js","assets/js/_initCloneObject-584d905d.js","assets/js/use-form-item-c4555cb1.js","assets/css/el-popper-9e0bc416.css","assets/js/_commonjsHelpers-725317a4.js","assets/css/el-table-column-838a2945.css","assets/js/el-space-1dbc7e91.js","assets/css/el-space-417b6673.css","assets/js/el-button-c98be082.js","assets/css/el-button-2cb60ae5.css","assets/js/el-text-3911e533.js","assets/css/el-text-557ef0ff.css","assets/js/copy-1adc0143.js","assets/js/user-8f13264d.js","assets/css/downloadDialog-abec4f6c.css"])),o=v(()=>_(()=>import("./aria2ConfigDialog-ae48da21.js"),["assets/js/aria2ConfigDialog-ae48da21.js","assets/js/base-8da118dd.js","assets/js/request-8bfac485.js","assets/js/index-5feb174a.js","assets/css/index-e5387e95.css","assets/css/base-34dba8e3.css","assets/js/el-overlay-d91e9200.js","assets/js/vnode-94723534.js","assets/js/focus-trap-9497ed29.js","assets/js/isNil-c75b1b34.js","assets/js/scroll-b2773a8f.js","assets/js/index-183e2613.js","assets/css/el-overlay-49152403.css","assets/js/el-form-item-a5087132.js","assets/js/use-form-item-c4555cb1.js","assets/js/_initCloneObject-584d905d.js","assets/css/el-form-item-7d5af5e1.css","assets/js/el-button-c98be082.js","assets/css/el-button-2cb60ae5.css","assets/js/el-input-aab76947.js","assets/css/el-input-45b6b5ba.css","assets/js/user-8f13264d.js"])),u=q();return I(u.getConfig),(w,F)=>(G(),U(x,null,[f(g(m)),f(g(a)),f(g(p)),f(g(l)),f(g(o))],64))}});const X=Object.freeze(Object.defineProperty({__proto__:null,default:J},Symbol.toStringTag,{value:"Module"}));export{X as U,q as u};
