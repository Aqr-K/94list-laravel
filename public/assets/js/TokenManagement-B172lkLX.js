import{b as G,$ as h,a0 as ee,r as V,e as y,c as z,m as l,k as a,x as r,w as f,j as J,F as Z,_ as ae,E as M,I as le,J as te,z as ne,Z as H,y as K,B as oe,A as Q,O as ue,v as W,o as de,q as U,t as v,a1 as k,u as P,C as j,S as se,a3 as ie,U as pe,a2 as me}from"./.pnpm-DQd76FlD.js";import{i as x}from"./index-Ce7BzsP2.js";import{c as re}from"./copy-CmnJBQmg.js";import{f as R}from"./format-DaCfCw6f.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";const _e=i=>x.post("/admin/token",i),ve=i=>x.post("/admin/token/generate",i),fe=i=>x.get(`/admin/token?page=${i.page}&size=${i.size}`),ye=i=>x.patch(`/admin/token/${i.id}`,i),ge=i=>x.delete("/admin/token",{data:{token_ids:[i.id]}}),ke=i=>x.delete("/admin/token",{data:{token_ids:i}}),Ve=G({__name:"AddToken",props:{modelValue:{},modelModifiers:{}},emits:h(["getTokens"],["update:modelValue"]),setup(i,{emit:c}){const $=c,T=ee(i,"modelValue"),b=V(!1),t=V({type:"single",name:"",count:1,size:1,day:1}),_=V(null),B={name:[{required:!0,message:"请输入卡密名称",trigger:"blur"}],token_count:[{required:!0,message:"请输入卡密个数",trigger:"blur"}],day:[{required:!0,message:"请输入卡密天数",trigger:"blur"}],count:[{required:!0,message:"请输入可下载次数",trigger:"blur"}],size:[{required:!0,message:"请输入可下载大小",trigger:"blur"}]},D=async C=>{if(!(!C||!await C.validate()))try{b.value=!0,t.value.type==="single"?await _e({type:"single",name:t.value.name,count:t.value.count,size:t.value.size,day:t.value.day}):await ve({type:"random",token_count:t.value.token_count,count:t.value.count,size:t.value.size,day:t.value.day}),M.success("添加成功")}finally{b.value=!1}},F=C=>{$("getTokens"),C()},q=()=>{T.value=!1,$("getTokens")};return(C,u)=>{const E=le,I=te,g=ne,n=H,s=K,p=oe,d=Q,L=ue,S=W;return y(),z(L,{title:"添加卡密",width:"60%",modelValue:T.value,"onUpdate:modelValue":u[8]||(u[8]=o=>T.value=o),"before-close":F},{footer:l(()=>[a(d,{type:"info",onClick:u[6]||(u[6]=o=>q())},{default:l(()=>[r("取消")]),_:1}),a(d,{type:"primary",onClick:u[7]||(u[7]=o=>D(_.value))},{default:l(()=>[r("添加")]),_:1})]),default:l(()=>[f((y(),z(p,{ref_key:"addTokenFormRef",ref:_,model:t.value,rules:B,"label-width":"auto"},{default:l(()=>[a(g,{label:"创建方式",prop:"type"},{default:l(()=>[a(I,{modelValue:t.value.type,"onUpdate:modelValue":u[0]||(u[0]=o=>t.value.type=o)},{default:l(()=>[(y(),J(Z,null,ae(["single","random"],o=>a(E,{key:o,label:o,value:o},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(g,{label:"可用次数",prop:"count"},{default:l(()=>[a(n,{modelValue:t.value.count,"onUpdate:modelValue":u[1]||(u[1]=o=>t.value.count=o)},null,8,["modelValue"])]),_:1}),a(g,{label:"可用天数",prop:"day"},{default:l(()=>[a(n,{modelValue:t.value.day,"onUpdate:modelValue":u[2]||(u[2]=o=>t.value.day=o)},null,8,["modelValue"])]),_:1}),a(g,{label:"可用大小(GB)",prop:"size"},{default:l(()=>[a(n,{modelValue:t.value.size,"onUpdate:modelValue":u[3]||(u[3]=o=>t.value.size=o)},null,8,["modelValue"])]),_:1}),t.value.type==="single"?(y(),z(g,{key:0,label:"卡密名称",prop:"name"},{default:l(()=>[a(s,{modelValue:t.value.name,"onUpdate:modelValue":u[4]||(u[4]=o=>t.value.name=o)},null,8,["modelValue"])]),_:1})):(y(),z(g,{key:1,label:"卡密个数",prop:"token_count"},{default:l(()=>[a(n,{modelValue:t.value.token_count,"onUpdate:modelValue":u[5]||(u[5]=o=>t.value.token_count=o)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])),[[S,b.value]])]),_:1},8,["modelValue"])}}}),be=G({__name:"TokenManagement",setup(i){const c=V(!1),$=V(15),T=V(1),b=V(),t=V([]),_=async()=>{try{c.value=!0;const n=await fe({page:T.value,size:$.value});b.value=n.data}finally{c.value=!1}},B=async n=>{n.edit=!(n.edit??!1)},D=async n=>{n.edit=!(n.edit??!0),await F(n)},F=async n=>{try{c.value=!0,await ye(n),M.success("修改卡密成功")}finally{c.value=!1,await _()}},q=async n=>{try{c.value=!0,await ge(n),M.success("删除卡密成功")}finally{c.value=!1,await _()}},C=async()=>{try{c.value=!0;const n=t.value.map(s=>s.id);await ke(n),M.success("删除卡密成功")}finally{c.value=!1,await _()}},u=n=>t.value=n;de(_);const E=V(!1),I=()=>E.value=!E.value,g=n=>{const p=(n?[n]:t.value).map(d=>[d.name,d.count,d.size,d.day].join(" | "));p.unshift(["卡密","可用次数","可下载量","可用天数"].join(" | ")),re(p.join(`
`))};return(n,s)=>{var A,N,O;const p=Q,d=se,L=K,S=H,o=ie,X=pe,Y=me,w=W;return y(),J(Z,null,[a(Ve,{onGetTokens:_,modelValue:E.value,"onUpdate:modelValue":s[0]||(s[0]=e=>E.value=e)},null,8,["modelValue"]),a(p,{type:"primary",onClick:s[1]||(s[1]=e=>_())},{default:l(()=>[r("刷新列表")]),_:1}),a(p,{type:"primary",onClick:s[2]||(s[2]=e=>I())},{default:l(()=>[r("添加卡密")]),_:1}),a(p,{type:"primary",onClick:s[3]||(s[3]=e=>g())},{default:l(()=>[r("批量复制")]),_:1}),a(p,{type:"danger",disabled:t.value.length<=0,onClick:s[4]||(s[4]=e=>C())},{default:l(()=>[r(" 批量删除 ")]),_:1},8,["disabled"]),f((y(),z(X,{data:((A=b.value)==null?void 0:A.data)??[],border:"","show-overflow-tooltip":"",class:"table",onSelectionChange:u},{default:l(()=>[a(d,{type:"selection",width:"40"}),a(d,{prop:"id",label:"ID"}),a(d,{prop:"name",label:"卡密名称"},{default:l(({row:e})=>[f(U("span",null,v(e.name),513),[[k,!e.edit]]),f(a(L,{modelValue:e.name,"onUpdate:modelValue":m=>e.name=m},null,8,["modelValue","onUpdate:modelValue"]),[[k,e.edit]])]),_:1}),a(d,{prop:"today_size",label:"今日解析"},{default:l(({row:e})=>[U("span",null,v(e.today_count)+" ("+v(P(R)(e.today_size??0))+")",1)]),_:1}),a(d,{prop:"today_size",label:"縂共解析"},{default:l(({row:e})=>[U("span",null,v(e.total_count)+" ("+v(P(R)(e.total_size??0))+")",1)]),_:1}),a(d,{prop:"count",label:"可用次数"},{default:l(({row:e})=>[f(U("span",null,v(e.count),513),[[k,!e.edit]]),f(a(S,{modelValue:e.count,"onUpdate:modelValue":m=>e.count=m},null,8,["modelValue","onUpdate:modelValue"]),[[k,e.edit]])]),_:1}),a(d,{prop:"size",label:"可下载大小"},{default:l(({row:e})=>[f(U("span",null,v(e.size),513),[[k,!e.edit]]),f(a(S,{modelValue:e.size,"onUpdate:modelValue":m=>e.size=m},null,8,["modelValue","onUpdate:modelValue"]),[[k,e.edit]])]),_:1}),a(d,{prop:"day",label:"有效期"},{default:l(({row:e})=>[f(U("span",null,v(e.day),513),[[k,!e.edit]]),f(a(S,{modelValue:e.day,"onUpdate:modelValue":m=>e.day=m},null,8,["modelValue","onUpdate:modelValue"]),[[k,e.edit]])]),_:1}),a(d,{prop:"expired_at",label:"到期时间",width:"250"},{default:l(({row:e})=>[f(U("span",null,v(e.expired_at?new Date(e.expired_at).toLocaleString():"未使用"),513),[[k,!e.edit]]),e.edit?(y(),z(o,{key:0,modelValue:e.expired_at,"onUpdate:modelValue":m=>e.expired_at=m,type:"datetime",placeholder:"请选择日期"},null,8,["modelValue","onUpdate:modelValue"])):j("",!0)]),_:1}),a(d,{prop:"created_at",label:"创建时间"},{default:l(({row:e})=>[r(v(new Date(e.created_at).toLocaleString()),1)]),_:1}),a(d,{prop:"updated_at",label:"更新时间"},{default:l(({row:e})=>[r(v(new Date(e.updated_at).toLocaleString()),1)]),_:1}),a(d,{width:"200",label:"操作",fixed:"right"},{default:l(({row:e})=>[e.edit?j("",!0):(y(),z(p,{key:0,size:"small",type:"primary",onClick:m=>B(e)},{default:l(()=>[r(" 编辑 ")]),_:2},1032,["onClick"])),e.edit?(y(),z(p,{key:1,size:"small",type:"primary",onClick:m=>D(e)},{default:l(()=>[r(" 保存 ")]),_:2},1032,["onClick"])):j("",!0),a(p,{size:"small",type:"primary",onClick:m=>g(e)},{default:l(()=>[r("复制")]),_:2},1032,["onClick"]),a(p,{size:"small",type:"danger",onClick:m=>q(e)},{default:l(()=>[r("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[w,c.value]]),a(Y,{"current-page":T.value,"onUpdate:currentPage":s[5]||(s[5]=e=>T.value=e),"page-size":$.value,"onUpdate:pageSize":s[6]||(s[6]=e=>$.value=e),"page-sizes":[15,50,100,500,((N=b.value)==null?void 0:N.total)??100],total:((O=b.value)==null?void 0:O.total)??100,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:_,onCurrentChange:_},null,8,["current-page","page-size","page-sizes","total"])],64)}}}),Ee=ce(be,[["__scopeId","data-v-aaf40ec2"]]);export{Ee as default};
