import{an as g,ao as h,r as i,ap as w,E as n,aq as F,ar as y}from"./index-B8pW1vfL.js";const{Axios:x,AxiosError:k,CanceledError:A,isCancel:C,CancelToken:E,VERSION:S,all:D,Cancel:P,isAxiosError:R,spread:V,toFormData:q,AxiosHeaders:H,HttpStatusCode:N,formToJSON:O,getAdapter:T,mergeConfig:$}=g,j=h("fileListStore",()=>{const s=i(!1),r=i({shorturl:"",url:"",pwd:"",dir:"/"}),c=i(null),f=()=>{const a=r.value.dir.split("/");a.pop();const l=a.join("/");return l===""?"/":l},_=async()=>{if(!(!c.value||!await c.value.validate()))try{s.value=!0;const a=await w(r.value);o.value=a.data,r.value.dir!=="/"&&o.value.list.unshift({category:-1,fs_id:0,isdir:1,local_ctime:0,local_mtime:0,server_ctime:0,server_mtime:0,size:0,md5:"",path:f(),server_filename:"..",dlink:""}),n.success("获取文件列表成功")}finally{s.value=!1}},o=i({uk:0,shareid:0,randsk:"",list:[]}),e=i({hit_captcha:!1,vcode_str:"",vcode_img:"",vcode_input:""}),u=i([]),d=i([]),p=async a=>{const l=a?[a]:u.value.map(t=>t.fs_id);try{s.value=!0;const t={uk:o.value.uk,shareid:o.value.shareid,randsk:o.value.randsk,fs_ids:l};e.value.hit_captcha&&(t.vcode_str=e.value.vcode_str,t.vcode_input=e.value.vcode_input);const v=await F(t);d.value=v.data,n.success("解析成功")}catch(t){t instanceof k||t.message==="触发验证码"&&m()}finally{s.value=!1,e.value.hit_captcha&&(e.value.hit_captcha=!1,e.value.vcode_str="",e.value.vcode_img="",e.value.vcode_input="")}},m=async()=>{try{n.info("开始尝试获取验证码"),s.value=!0;const a=await y();e.value.hit_captcha=!0,e.value.vcode_str=a.data.vcode,e.value.vcode_img=a.data.img}finally{s.value=!1}};return{pending:s,vcode:e,fileList:o,getFileList:_,getFileListForm:r,getFileListFormRef:c,selectedRows:u,downloadFiles:p,downloadLinks:d}});export{j as u};
