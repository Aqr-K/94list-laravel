import{b as q,J as M,o as J,L as W,E,u as j,r as H,w as K,e as t,f as u,c as m,n as r,q as S,t as O,C as c,l as a,k as A,F as U,x as _,M as Q,y as X,z as Y,A as ee,B as te,p as le,v as oe}from"./.pnpm-CR973naf.js";import{u as se}from"./fileListStore-Af5gXXvc.js";import{u as ae,a as re,g as B,c as ne}from"./index-BcjYLXzc.js";import{c as ie}from"./copy-3KwjvvQT.js";import{f as ue}from"./format-DaCfCw6f.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";const pe=["src"],me=q({__name:"GetFileList",setup(ce){const v=se(),{pending:R,getFileListForm:o,getFileListFormRef:b,selectedRows:z,limitForm:k,hitLimit:L,vcode:f}=M(v),V=ae(),{config:w}=M(V),x=(l,e,n)=>e===""?n(new Error("请先输入需要解析的链接")):F(e)?n():n(new Error("请输入合法的链接")),D=()=>{o.value.dir="/",o.value.surl="";const l=F(o.value.url);l&&(l.id&&(l.surl?(o.value.url=`https://pan.baidu.com/share/init?surl=${l.id}`,o.value.surl=`1${l.id}`):(o.value.url=`https://pan.baidu.com/s/${l.id}`,o.value.surl=l.id)),l.pwd&&(o.value.pwd=l.pwd,E.success("已自动填写密码")))},F=l=>{const e=l.match(/s\/([a-zA-Z0-9_-]+)/),n=l.match(/surl=([a-zA-Z0-9_-]+)/),d=l.match(/\?pwd=([a-zA-Z0-9_-]+)/),i=l.match(/&pwd=([a-zA-Z0-9_-]+)/),p=l.match(/提取码:\s?([a-zA-Z0-9_-]+)/);let g;if(n)g=n[1];else if(e)g=e[1];else return!1;const y=d?d[1]:i?i[1]:p?p[1]:null;return n?{surl:!0,id:g,pwd:y}:{id:g,pwd:y}},N={url:[{required:!0,validator:x,trigger:"blur"}]},T=async l=>{if(!l||!await l.validate())return;const e=new URLSearchParams;e.set("url",o.value.url),e.set("surl",o.value.surl),e.set("pwd",o.value.pwd),e.set("dir",o.value.dir),ie(`${location.host}/?${e.toString()}`,"复制成功")};J(()=>{W(()=>{const l=new URLSearchParams(location.search);l.size<4||(o.value={url:l.get("url")??"",pwd:l.get("pwd")??"",dir:l.get("dir")??"/",surl:l.get("surl")??""},E.success("已读取到参数,正在加载"),setTimeout(v.getFileList,1e3))}),v.getLimit(),C()});const $=j(),Z=()=>$.push("/login"),I=()=>$.push("/admin");function G(){window.open("https://github.com/huankong233/94list-laravel")}const h=H(0),C=()=>h.value=Date.now();return(l,e)=>{const n=Q,d=X,i=Y,p=ee,g=te,y=le,P=oe;return K((u(),m(y,null,{default:r(()=>[S("h2",null,"前台解析中心 | "+O(t(re)()),1),t(w).show_copyright?(u(),m(n,{key:0,"show-icon":"",type:"warning",closable:!1,title:"项目全部开源,开源地址: https://github.com/huankong233/94list-laravel",onClick:e[0]||(e[0]=s=>G()),class:"cursor"})):c("",!0),t(w).have_account?(u(),m(n,{key:1,closable:!1,class:"alert",title:"当前中转账号充足",type:"success"})):(u(),m(n,{key:2,closable:!1,class:"alert",title:"当前中转账号不足",type:"error"})),t(w).debug?(u(),m(n,{key:3,class:"alert",title:"当前网站开启了DEBUG模式,非调试请关闭!!!!",type:"error",closable:!1})):c("",!0),t(w).is_https?c("",!0):(u(),m(n,{key:4,class:"alert",title:"当前网站未开启SSL,可能出现无法请求Aria2服务器的问题",type:"error",closable:!1})),a(n,{class:"alert",type:t(L)?"error":"success",closable:!1,title:t(L)?"当前用户配额已用完":`当前用户组: ${t(k).group_name} 当前剩余解析文件数: ${t(k).count} 当前剩余解析大小: ${t(ue)(t(k).size)}`},null,8,["type","title"]),a(g,{ref_key:"getFileListFormRef",ref:b,model:t(o),rules:N,"label-width":"auto",class:"form"},{default:r(()=>[a(i,{label:"链接",prop:"url"},{default:r(()=>[a(d,{modelValue:t(o).url,"onUpdate:modelValue":e[1]||(e[1]=s=>t(o).url=s),modelModifiers:{trim:!0},onBlur:e[2]||(e[2]=s=>D())},null,8,["modelValue"])]),_:1}),a(i,{label:"密码",prop:"pwd"},{default:r(()=>[a(d,{modelValue:t(o).pwd,"onUpdate:modelValue":e[3]||(e[3]=s=>t(o).pwd=s),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),t(w).need_password?(u(),m(i,{key:0,label:"解析密码",prop:"password"},{default:r(()=>[a(d,{modelValue:t(o).password,"onUpdate:modelValue":e[4]||(e[4]=s=>t(o).password=s),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1})):c("",!0),a(i,{label:"当前路径",prop:"dir"},{default:r(()=>[a(d,{modelValue:t(o).dir,"onUpdate:modelValue":e[5]||(e[5]=s=>t(o).dir=s),disabled:""},null,8,["modelValue"])]),_:1}),t(f).hit_captcha?(u(),A(U,{key:1},[a(i,{label:"验证码编号",prop:"vcode_str"},{default:r(()=>[a(d,{modelValue:t(f).vcode_str,"onUpdate:modelValue":e[6]||(e[6]=s=>t(f).vcode_str=s),disabled:""},null,8,["modelValue"])]),_:1}),a(i,{label:"验证码图片",prop:"vcode_img"},{default:r(()=>[S("img",{src:`${t(f).vcode_img}&t=${h.value}`,alt:"验证码图片",onClick:C},null,8,pe)]),_:1}),a(i,{label:"验证码字符",prop:"vcode_input"},{default:r(()=>[a(d,{modelValue:t(f).vcode_input,"onUpdate:modelValue":e[7]||(e[7]=s=>t(f).vcode_input=s)},null,8,["modelValue"])]),_:1})],64)):c("",!0),a(i,{label:" "},{default:r(()=>[a(p,{type:"primary",onClick:e[8]||(e[8]=s=>t(v).getFileList())},{default:r(()=>[_("获取/刷新列表")]),_:1}),a(p,{type:"primary",disabled:t(z).length<=0,onClick:e[9]||(e[9]=s=>t(v).getDownloadLinks())},{default:r(()=>[_(" 批量解析 ")]),_:1},8,["disabled"]),a(p,{type:"primary",onClick:e[10]||(e[10]=s=>T(t(b)))},{default:r(()=>[_("复制当前地址")]),_:1}),t(B)()==="0"?(u(),m(p,{key:0,type:"primary",onClick:e[11]||(e[11]=s=>Z())},{default:r(()=>[_("登陆")]),_:1})):c("",!0),t(B)()==="1"?(u(),A(U,{key:1},[t(ne)()==="admin"?(u(),m(p,{key:0,type:"primary",onClick:e[12]||(e[12]=s=>I())},{default:r(()=>[_(" 进入后台 ")]),_:1})):c("",!0),a(p,{type:"danger",onClick:e[13]||(e[13]=s=>t(V).logout())},{default:r(()=>[_(" 注销 ")]),_:1})],64)):c("",!0)]),_:1})]),_:1},8,["model"])]),_:1})),[[P,t(R)]])}}}),ke=de(me,[["__scopeId","data-v-12dbd3ad"]]);export{ke as default};
