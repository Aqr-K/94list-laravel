import{e as k,f as y,h as F}from"./index-DUn7j5K3.js";import{d as _,r as t,E as r}from"./.pnpm-BPJ2h7HZ.js";const P=_("fileListStore",()=>{const a=t(!1),s=t({surl:"",url:"",pwd:"",dir:"/",password:""}),o=t(null),p=()=>{const e=s.value.dir.split("/");e.pop();const u=e.join("/");return u===""?"/":u},L=async()=>{if(!(!o.value||!await o.value.validate())){if(s.value.surl==="")return r.error("获取链接surl失败");try{n.value=[],a.value=!0;const e=await k(s.value);i.value=e.data,s.value.dir!=="/"&&i.value.list.unshift({category:-1,fs_id:0,isdir:1,local_ctime:0,local_mtime:0,server_ctime:0,server_mtime:0,size:0,md5:"",path:p(),server_filename:"..",dlink:""}),r.success("获取文件列表成功")}finally{a.value=!1}}},i=t({uk:0,shareid:0,randsk:"",list:[]}),n=t([]),m=t([]),h=async(e,u=!1)=>{if(a.value){r.info("请勿重复点击~");return}const w=e?[e]:n.value.filter(l=>l.isdir!==1).map(l=>l.fs_id);e===void 0&&w.length!==n.value.length&&r.error("文件夹不会被解析!");let v;try{a.value=!0;const l={uk:i.value.uk,shareid:i.value.shareid,randsk:i.value.randsk,fs_ids:w,password:s.value.password};if(v=await y(l),r.success("解析成功,下载链接请下滑"),u)return a.value=!1,await d(),v.data.map(f=>({...f,index:0}));m.value=v.data.map(f=>({...f,index:0}))}finally{a.value=!1,await d()}},g=t({group_name:"",count:0,size:0}),c=t(!1),d=async()=>{try{a.value=!0;const e=await F();g.value=e.data,c.value=!1}catch{c.value=!0}finally{a.value=!1}};return{pending:a,fileList:i,getFileList:L,getFileListForm:s,getFileListFormRef:o,selectedRows:n,downloadLinks:m,getDownloadLinks:h,limitForm:g,getLimit:d,hitLimit:c}});export{P as u};
