import{b as S,K as C,r as F,u as i,e as N,c as T,m as a,k as e,s as n,t as B,B as L,q as V,E as c,z as x,O as U,N as z,T as j,P,p as q}from"./.pnpm-iATkil5N.js";import{i as K,a as M}from"./index-ctO0osHI.js";import{u as O}from"./aria2Store-CsQfdHDy.js";import{u as R}from"./fileListStore-CTfzH0o3.js";import{c as y}from"./copy-CBlLxS-i.js";const G=m=>new Promise(p=>setTimeout(p,m)),H=V("h2",null,"链接列表",-1),Y=S({__name:"DownloadLinks",setup(m){const p=R(),{downloadLinks:_}=C(p),u=F([]),b=t=>u.value=t,g=O(),{aria2ConfigForm:d,aria2ConfigDialogVisible:v}=C(g),f=async t=>{try{await K.post(`${d.value.host}:${d.value.port}/jsonrpc`,{jsonrpc:"2.0",id:M(),method:"aria2.addUri",params:[`token:${d.value.token}`,[t.url],{out:t.filename,header:[`User-Agent: ${t.ua}`]}]})}catch{return c.error("发送失败, 请检查控制台输出, 自行谷歌搜索或提交issue")}c.success(`已把${t.filename}任务发送给下载器`)},h=async()=>{c.error("请确保最大同时下载文件数在5及以下,否则可能出现下载失败!"),await G(3e3),c.success("开始下载"),u.value.forEach(t=>f(t))},$=()=>v.value=!0;return(t,s)=>{const r=x,w=U,l=z,E=j,D=P,A=q;return i(_).length!==0?(N(),T(A,{key:0,class:"card"},{default:a(()=>[H,e(w,null,{default:a(()=>[e(r,{type:"primary",disabled:u.value.length<=0,onClick:s[0]||(s[0]=o=>h())},{default:a(()=>[n(" 批量下载 ")]),_:1},8,["disabled"]),e(r,{type:"primary",onClick:s[1]||(s[1]=o=>$())},{default:a(()=>[n("下载配置")]),_:1})]),_:1}),e(D,{border:"","show-overflow-tooltip":"",class:"table",data:i(_),onSelectionChange:b},{default:a(()=>[e(l,{type:"selection",width:"40"}),e(l,{prop:"ua",label:"UA"},{default:a(({row:o})=>[e(E,{type:"danger",onClick:k=>i(y)(o.ua,"已复制UA")},{default:a(()=>[n(B(o.ua),1)]),_:2},1032,["onClick"])]),_:1}),e(l,{prop:"filename",label:"文件名"}),e(l,{prop:"url",label:"下载链接"}),e(l,{label:"操作",width:"190"},{default:a(({row:o})=>[e(r,{type:"primary",size:"small",onClick:k=>i(y)(o.url,"已将链接复制到粘贴板内")},{default:a(()=>[n(" 复制链接 ")]),_:2},1032,["onClick"]),e(r,{type:"primary",size:"small",onClick:k=>f(o)},{default:a(()=>[n(" 发送Aria2 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})):L("",!0)}}});export{Y as default};
