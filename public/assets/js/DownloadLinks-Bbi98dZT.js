import{b as j,J as C,r as M,e as i,f as c,c as _,n as a,l as n,x as o,t as v,k as P,F as q,C as J,q as h,E as u,A as O,O as R,N as G,T as H,P as I,p as K}from"./.pnpm-CR973naf.js";import{u as Q,i as W,a as X}from"./index-BcjYLXzc.js";import{u as Y}from"./aria2Store-CLNsPJAv.js";import{u as Z}from"./fileListStore-Af5gXXvc.js";import{c as x}from"./copy-3KwjvvQT.js";const w=b=>new Promise(m=>setTimeout(m,b)),ee=h("h2",null,"链接列表",-1),te=h("h3",null,"下载请携带特定UA(点击即可复制)",-1),ae=h("h3",null,"如果当前链接下载失败,请尝试更换链接,如果全部不可用可以单独重新解析单个文件",-1),re=j({__name:"DownloadLinks",setup(b){const m=Q(),{config:f}=C(m),$=Z(),{downloadLinks:d}=C($),k=M([]),A=t=>k.value=t,S=Y(),{aria2ConfigForm:g,aria2ConfigDialogVisible:F}=C(S),D=async t=>{try{await W.post(`${g.value.host}:${g.value.port}/jsonrpc`,{jsonrpc:"2.0",id:X(),method:"aria2.addUri",params:[`token:${g.value.token}`,[t.urls?t.urls[t.index]:t.url],{out:t.filename,header:[`User-Agent: ${f.value.user_agent}`]}]})}catch{return u.error("发送失败, 请检查控制台输出, 自行谷歌搜索或提交issue")}u.success(`已把${t.filename}任务发送给下载器`)},L=async()=>{u.error("请确保最大同时下载文件数在5及以下,否则可能出现下载失败!"),await w(3e3),u.success("开始下载"),k.value.forEach(t=>D(t))},N=()=>F.value=!0,E=async(t,s)=>{const l=await $.getDownloadLinks(s,!0);if(!l)return u.error("重新解析失败");d.value[t]=l[0]},T=t=>{d.value[t].index++};return(t,s)=>{const l=O,U=R,r=G,z=H,B=I,V=K;return i(d).length!==0?(c(),_(V,{key:0,class:"card"},{default:a(()=>[ee,te,ae,n(U,null,{default:a(()=>[n(l,{type:"primary",disabled:k.value.length<=0,onClick:s[0]||(s[0]=e=>L())},{default:a(()=>[o(" 批量下载 ")]),_:1},8,["disabled"]),n(l,{type:"primary",onClick:s[1]||(s[1]=e=>N())},{default:a(()=>[o("下载配置")]),_:1})]),_:1}),n(B,{border:"","show-overflow-tooltip":"",class:"table",data:i(d),onSelectionChange:A},{default:a(()=>[n(r,{type:"selection",width:"40"}),n(r,{prop:"ua",label:"UA"},{default:a(({})=>[n(z,{type:"danger",onClick:s[2]||(s[2]=e=>i(x)(i(f).user_agent,"已复制UA"))},{default:a(()=>[o(v(i(f).user_agent),1)]),_:1})]),_:1}),n(r,{prop:"filename",label:"文件名"}),n(r,{prop:"url",label:"下载链接"},{default:a(({row:e})=>[o(v(e.urls?e.urls[e.index]:e.url),1)]),_:1}),n(r,{label:"操作",width:"450"},{default:a(({row:e,$index:y})=>[n(l,{type:"primary",size:"small",onClick:p=>i(x)(e.urls?e.urls[e.index]:e.url,"已将链接复制到粘贴板内")},{default:a(()=>[o(" 复制链接 ")]),_:2},1032,["onClick"]),n(l,{type:"primary",size:"small",onClick:p=>D(e)},{default:a(()=>[o(" 发送Aria2 ")]),_:2},1032,["onClick"]),e.urls?(c(),P(q,{key:0},[e.index<e.urls.length-1?(c(),_(l,{key:0,type:"danger",size:"small",onClick:p=>T(y)},{default:a(()=>[o(" 更换链接 (当前第"+v(e.index+1)+"条链接) ",1)]),_:2},1032,["onClick"])):(c(),_(l,{key:1,type:"danger",size:"small",onClick:p=>E(y,e.fs_id)},{default:a(()=>[o(" 重新解析 ")]),_:2},1032,["onClick"]))],64)):(c(),_(l,{key:1,type:"danger",size:"small",onClick:p=>E(y,e.fs_id)},{default:a(()=>[o(" 重新解析 ")]),_:2},1032,["onClick"]))]),_:1})]),_:1},8,["data"])]),_:1})):J("",!0)}}});export{re as default};
