import{b as V,J as C,r as j,e as r,f as c,c as _,n as t,l as n,x as o,t as v,k as M,F as P,C as q,q as h,E as u,A as J,O,N as R,T as G,P as H,p as I}from"./.pnpm-BPJ2h7HZ.js";import{u as K,i as Q,a as W}from"./index-CTCYKE6Q.js";import{u as X}from"./aria2Store-B3H0HSPG.js";import{u as Y}from"./fileListStore-DgfbOFWa.js";import{c as A}from"./copy-BEhOFPun.js";const Z=b=>new Promise(m=>setTimeout(m,b)),ee=h("h2",null,"链接列表",-1),te=h("h3",null,"下载请携带特定UA(点击即可复制)",-1),ae=h("h3",null,"如果当前链接下载失败,请尝试更换链接,如果全部不可用可以单独重新解析单个文件",-1),ie=V({__name:"DownloadLinks",setup(b){const m=K(),{config:f}=C(m),$=Y(),{downloadLinks:d}=C($),k=j([]),S=a=>k.value=a,F=X(),{aria2ConfigForm:g,aria2ConfigDialogVisible:x}=C(F),D=async a=>{try{await Q.post(`${g.value.host}:${g.value.port}/jsonrpc`,{jsonrpc:"2.0",id:W(),method:"aria2.addUri",params:[`token:${g.value.token}`,[a.url],{out:a.filename,header:[`User-Agent: ${f.value.user_agent}`]}]})}catch{return u.error("发送失败, 请检查控制台输出, 自行谷歌搜索或提交issue")}u.success(`已把${a.filename}任务发送给下载器`)},L=async()=>{u.error("请确保最大同时下载文件数在5及以下,否则可能出现下载失败!"),await Z(3e3),u.success("开始下载"),k.value.forEach(a=>D(a))},N=()=>x.value=!0,E=async(a,s)=>{const l=await $.getDownloadLinks(s,!0);if(!l)return u.error("重新解析失败");d.value[a]=l[0]},T=a=>{d.value[a].index++};return(a,s)=>{const l=J,U=O,i=R,w=G,z=H,B=I;return r(d).length!==0?(c(),_(B,{key:0,class:"card"},{default:t(()=>[ee,te,ae,n(U,null,{default:t(()=>[n(l,{type:"primary",disabled:k.value.length<=0,onClick:s[0]||(s[0]=e=>L())},{default:t(()=>[o(" 批量下载 ")]),_:1},8,["disabled"]),n(l,{type:"primary",onClick:s[1]||(s[1]=e=>N())},{default:t(()=>[o("下载配置")]),_:1})]),_:1}),n(z,{border:"","show-overflow-tooltip":"",class:"table",data:r(d),onSelectionChange:S},{default:t(()=>[n(i,{type:"selection",width:"40"}),n(i,{prop:"ua",label:"UA"},{default:t(({})=>[n(w,{type:"danger",onClick:s[2]||(s[2]=e=>r(A)(r(f).user_agent,"已复制UA"))},{default:t(()=>[o(v(r(f).user_agent),1)]),_:1})]),_:1}),n(i,{prop:"filename",label:"文件名"}),n(i,{prop:"url",label:"下载链接"},{default:t(({row:e})=>[o(v(e.urls?e.urls[e.index]:e.url),1)]),_:1}),n(i,{label:"操作",width:"450"},{default:t(({row:e,$index:y})=>[n(l,{type:"primary",size:"small",onClick:p=>r(A)(e.url,"已将链接复制到粘贴板内")},{default:t(()=>[o(" 复制链接 ")]),_:2},1032,["onClick"]),n(l,{type:"primary",size:"small",onClick:p=>D(e)},{default:t(()=>[o(" 发送Aria2 ")]),_:2},1032,["onClick"]),e.urls?(c(),M(P,{key:0},[e.index<e.urls.length-1?(c(),_(l,{key:0,type:"danger",size:"small",onClick:p=>T(y)},{default:t(()=>[o(" 更换链接 (当前第"+v(e.index+1)+"条链接) ",1)]),_:2},1032,["onClick"])):(c(),_(l,{key:1,type:"danger",size:"small",onClick:p=>E(y,e.fs_id)},{default:t(()=>[o(" 重新解析 ")]),_:2},1032,["onClick"]))],64)):(c(),_(l,{key:1,type:"danger",size:"small",onClick:p=>E(y,e.fs_id)},{default:t(()=>[o(" 重新解析 ")]),_:2},1032,["onClick"]))]),_:1})]),_:1},8,["data"])]),_:1})):q("",!0)}}});export{ie as default};
