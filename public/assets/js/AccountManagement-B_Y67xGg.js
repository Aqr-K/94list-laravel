import"./base-sonieuUH.js";import{v as L}from"./el-loading-DqZh-wdt.js";import{E as N}from"./el-pagination-rqD1yhvC.js";import{E as T}from"./el-input-CfnbBfaI.js";import"./el-tag-D4crlrEn.js";import"./el-select-BOuFmw6D.js";import{E as P,a as R}from"./el-table-column-CCkEx7ov.js";import{E as B}from"./el-button-DDufFYF5.js";import{aa as A,d as U,aM as q,aN as G,r as p,o as w,e as M,f as t,a as e,k as u,w as h,E as k,O,c as j,i as H,t as b,a4 as J,F as K}from"./index-B8pW1vfL.js";import{E as Q}from"./el-overlay-D-CosnQY.js";import{E as W,a as X}from"./el-form-item-gk2EoJqp.js";import{E as Y}from"./AdminView-BtWSCJBc.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-24Q8zd9x.js";import"./use-form-item-CJFbIM6h.js";import"./focus-trap-Cx3G5mYf.js";import"./scroll-uoENNN5t.js";import"./vnode-CTXkDMm_.js";import"./el-card-DSxRm4_o.js";import"./user-BMVG4AFv.js";const ee=l=>A.post("/admin/account",l),te=l=>A.get(`/admin/account?page=${l.page}&size=${l.size}`),ae=l=>A.patch(`/admin/account/${l.id}`),oe=l=>A.patch("/admin/account",{account_ids:l}),le=l=>A.delete(`/admin/account/${l.id}`),ne=l=>A.delete("/admin/account",{data:{account_ids:l}}),ce=U({__name:"AddAccount",props:{modelValue:{},modelModifiers:{}},emits:q(["getAccounts"],["update:modelValue"]),setup(l,{emit:c}){const y=c,_=G(l,"modelValue"),f=p(!1),r=p({cookie:""}),i=p(null),C={cookie:[{required:!0,message:"请输入Cookie",trigger:"blur"}]},E=async v=>{if(!(!v||!await v.validate()))try{f.value=!0,await ee({cookie:r.value.cookie.split(`
`)}),k.success("添加成功")}finally{f.value=!1}},V=v=>{y("getAccounts"),v()},z=()=>{_.value=!1,y("getAccounts")};return(v,s)=>{const S=Y,n=W,d=T,m=X,o=B,$=Q,x=L;return w(),M($,{title:"添加账号",width:"60%",modelValue:_.value,"onUpdate:modelValue":s[3]||(s[3]=g=>_.value=g),"before-close":V},{footer:t(()=>[e(o,{type:"info",onClick:s[1]||(s[1]=g=>z())},{default:t(()=>[u("取消")]),_:1}),e(o,{type:"primary",onClick:s[2]||(s[2]=g=>E(i.value))},{default:t(()=>[u("添加")]),_:1})]),default:t(()=>[h((w(),M(m,{ref_key:"addAccountFormRef",ref:i,model:r.value,rules:C,"label-width":"auto"},{default:t(()=>[e(n,{label:"提示"},{default:t(()=>[e(S,null,{default:t(()=>[u("可以使用换行来分割多个账号")]),_:1})]),_:1}),e(n,{label:"Cookie",prop:"cookie"},{default:t(()=>[e(d,{type:"textarea",modelValue:r.value.cookie,"onUpdate:modelValue":s[0]||(s[0]=g=>r.value.cookie=g),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[x,f.value]])]),_:1},8,["modelValue"])}}}),se=U({__name:"AccountManagement",setup(l){const c=p(!1),y=p(15),_=p(1),f=p(),r=p([]),i=async()=>{try{c.value=!0;const n=await te({page:_.value,size:y.value});f.value=n.data}finally{c.value=!1}},C=async n=>{try{c.value=!0,await ae(n),k.success("更新账户信息成功")}finally{c.value=!1,await i()}},E=async()=>{try{c.value=!0;const n=r.value.map(d=>d.id);await oe(n),k.success("批量更新账户成功")}finally{c.value=!1,await i()}},V=async n=>{try{c.value=!0,await le(n),k.success("删除账户成功")}finally{c.value=!1,await i()}},z=async()=>{try{c.value=!0;const n=r.value.map(d=>d.id);await ne(n),k.success("批量删除账户成功")}finally{c.value=!1,await i()}},v=n=>r.value=n;O(i);const s=p(!1),S=()=>s.value=!s.value;return(n,d)=>{var D,F;const m=B,o=P,$=R,x=N,g=L;return w(),j(K,null,[e(ce,{onGetAccounts:i,modelValue:s.value,"onUpdate:modelValue":d[0]||(d[0]=a=>s.value=a)},null,8,["modelValue"]),e(m,{type:"primary",onClick:i},{default:t(()=>[u("刷新列表")]),_:1}),e(m,{type:"primary",onClick:S},{default:t(()=>[u("添加账号")]),_:1}),e(m,{type:"primary",disabled:r.value.length<=0,onClick:E},{default:t(()=>[u(" 批量更新信息 ")]),_:1},8,["disabled"]),e(m,{type:"danger",disabled:r.value.length<=0,onClick:z},{default:t(()=>[u(" 批量删除 ")]),_:1},8,["disabled"]),h((w(),M($,{data:((D=f.value)==null?void 0:D.data)??[],border:"","show-overflow-tooltip":"",class:"table",onSelectionChange:v},{default:t(()=>[e(o,{type:"selection",width:"40"}),e(o,{prop:"id",label:"ID"}),e(o,{prop:"baidu_name",label:"百度用户名"}),e(o,{prop:"netdisk_name",label:"网盘用户名"}),e(o,{prop:"cookie",label:"Cookie"}),e(o,{prop:"vip_type",label:"会员类型"}),e(o,{prop:"switch",label:"状态"},{default:t(({row:a})=>[h(H("span",null,b(a.switch?"启用":"禁用"),513),[[J,!a.edit]])]),_:1}),e(o,{prop:"reason",label:"禁用原因"}),e(o,{prop:"svip_end_at",label:"超级会员结束时间"},{default:t(({row:a})=>[u(b(new Date(a.svip_end_at).toLocaleString()),1)]),_:1}),e(o,{prop:"last_use_at",label:"上次使用时间"},{default:t(({row:a})=>[u(b(new Date(a.last_use_at).toLocaleString()),1)]),_:1}),e(o,{prop:"created_at",label:"创建时间"},{default:t(({row:a})=>[u(b(new Date(a.created_at).toLocaleString()),1)]),_:1}),e(o,{prop:"updated_at",label:"更新时间"},{default:t(({row:a})=>[u(b(new Date(a.updated_at).toLocaleString()),1)]),_:1}),e(o,{width:"160",label:"操作",fixed:"right"},{default:t(({row:a})=>[e(m,{size:"small",type:"primary",onClick:I=>C(a)},{default:t(()=>[u("更新信息")]),_:2},1032,["onClick"]),e(m,{size:"small",type:"danger",onClick:I=>V(a)},{default:t(()=>[u("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[g,c.value]]),e(x,{"current-page":_.value,"onUpdate:currentPage":d[1]||(d[1]=a=>_.value=a),"page-size":y.value,"onUpdate:pageSize":d[2]||(d[2]=a=>y.value=a),"page-sizes":[15,30,50,100],total:((F=f.value)==null?void 0:F.total)??100,layout:"sizes, prev, pager, next",onSizeChange:i,onCurrentChange:i},null,8,["current-page","page-size","total"])],64)}}}),$e=Z(se,[["__scopeId","data-v-e76567d3"]]);export{$e as default};
