import{b as Z,J as $,o as D,L as I,E as h,u as T,w as G,e as t,f as u,c as d,n as i,q as P,t as q,l as a,C as f,x as g,M as J,y as W,z as j,A as H,B as K,p as O,v as Q}from"./.pnpm-TARA5JeW.js";import{u as X}from"./fileListStore-BYm1sobl.js";import{u as Y,a as ee,g as C,c as te}from"./index--d9Pblwj.js";import{c as le}from"./copy-BsygMIAv.js";import{f as oe}from"./format-DaCfCw6f.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";const se=Z({__name:"GetFileList",setup(ae){const w=X(),{pending:M,getFileListForm:o,getFileListFormRef:k,selectedRows:S,limitForm:v,hitLimit:L}=$(w),b=Y(),{config:y}=$(b),A=(l,e,s)=>e===""?s(new Error("请先输入需要解析的链接")):V(e)?s():s(new Error("请输入合法的链接")),E=()=>{o.value.dir="/",o.value.surl="";const l=V(o.value.url);l&&(l.id&&(l.surl?(o.value.url=`https://pan.baidu.com/share/init?surl=${l.id}`,o.value.surl=`1${l.id}`):(o.value.url=`https://pan.baidu.com/s/${l.id}`,o.value.surl=l.id)),l.pwd&&(o.value.pwd=l.pwd,h.success("已自动填写密码")))},V=l=>{const e=l.match(/s\/([a-zA-Z0-9_-]+)/),s=l.match(/surl=([a-zA-Z0-9_-]+)/),m=l.match(/\?pwd=([a-zA-Z0-9_-]+)/),p=l.match(/&pwd=([a-zA-Z0-9_-]+)/),n=l.match(/提取码:\s?([a-zA-Z0-9_-]+)/);let c;if(s)c=s[1];else if(e)c=e[1];else return!1;const _=m?m[1]:p?p[1]:n?n[1]:null;return s?{surl:!0,id:c,pwd:_}:{id:c,pwd:_}},R={url:[{required:!0,validator:A,trigger:"blur"}]},z=async l=>{if(!l||!await l.validate())return;const e=new URLSearchParams;e.set("url",o.value.url),e.set("surl",o.value.surl),e.set("pwd",o.value.pwd),e.set("dir",o.value.dir),le(`${location.host}/?${e.toString()}`,"复制成功")};D(()=>{I(()=>{const l=new URLSearchParams(location.search);l.size<4||(o.value={url:l.get("url")??"",pwd:l.get("pwd")??"",dir:l.get("dir")??"/",surl:l.get("surl")??""},h.success("已读取到参数,正在加载"),setTimeout(w.getFileList,1e3))}),w.getLimit()});const F=T(),B=()=>F.push("/login"),U=()=>F.push("/admin");function x(){window.open("https://github.com/huankong233/94list-laravel")}return(l,e)=>{const s=J,m=W,p=j,n=H,c=K,_=O,N=Q;return G((u(),d(_,null,{default:i(()=>[P("h2",null,"前台解析中心 | "+q(t(ee)()),1),a(s,{"show-icon":"",type:"warning",closable:!1,title:"项目全部开源,开源地址: https://github.com/huankong233/94list-laravel",onClick:e[0]||(e[0]=r=>x()),class:"cursor"}),t(y).have_account?(u(),d(s,{key:0,class:"alert",title:"当前中转账号充足",type:"success"})):(u(),d(s,{key:1,class:"alert",title:"当前中转账号不足",type:"error"})),t(y).debug?(u(),d(s,{key:2,class:"alert",title:"当前网站开启了DEBUG模式,非调试请关闭!!!!",type:"error"})):f("",!0),t(y).is_https?f("",!0):(u(),d(s,{key:3,class:"alert",title:"当前网站未开启SSL,可能出现无法请求Aria2服务器的问题",type:"error"})),a(s,{class:"alert",type:t(L)?"error":"success",title:t(L)?"当前用户配额已用完":`当前用户组: ${t(v).group_name} 当前剩余解析次数: ${t(v).count} 当前剩余解析大小: ${t(oe)(t(v).size)}`},null,8,["type","title"]),a(c,{ref_key:"getFileListFormRef",ref:k,model:t(o),rules:R,"label-width":"auto",class:"form"},{default:i(()=>[a(p,{label:"链接",prop:"url"},{default:i(()=>[a(m,{modelValue:t(o).url,"onUpdate:modelValue":e[1]||(e[1]=r=>t(o).url=r),modelModifiers:{trim:!0},onBlur:e[2]||(e[2]=r=>E())},null,8,["modelValue"])]),_:1}),a(p,{label:"密码",prop:"pwd"},{default:i(()=>[a(m,{modelValue:t(o).pwd,"onUpdate:modelValue":e[3]||(e[3]=r=>t(o).pwd=r),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),t(y).need_password?(u(),d(p,{key:0,label:"解析密码",prop:"password"},{default:i(()=>[a(m,{modelValue:t(o).password,"onUpdate:modelValue":e[4]||(e[4]=r=>t(o).password=r),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1})):f("",!0),a(p,{label:"当前路径",prop:"dir"},{default:i(()=>[a(m,{modelValue:t(o).dir,"onUpdate:modelValue":e[5]||(e[5]=r=>t(o).dir=r),disabled:""},null,8,["modelValue"])]),_:1}),a(p,{label:" "},{default:i(()=>[a(n,{type:"primary",onClick:e[6]||(e[6]=r=>t(w).getFileList())},{default:i(()=>[g("获取/刷新列表")]),_:1}),a(n,{type:"primary",disabled:t(S).length<=0,onClick:e[7]||(e[7]=r=>t(w).getDownloadLinks())},{default:i(()=>[g(" 批量解析 ")]),_:1},8,["disabled"]),a(n,{type:"primary",onClick:e[8]||(e[8]=r=>z(t(k)))},{default:i(()=>[g("复制当前地址")]),_:1}),t(C)()==="0"?(u(),d(n,{key:0,type:"primary",onClick:e[9]||(e[9]=r=>B())},{default:i(()=>[g("登陆")]),_:1})):f("",!0),t(te)()==="admin"?(u(),d(n,{key:1,type:"primary",onClick:e[10]||(e[10]=r=>U())},{default:i(()=>[g(" 进入后台 ")]),_:1})):f("",!0),t(C)()==="1"?(u(),d(n,{key:2,type:"danger",onClick:e[11]||(e[11]=r=>t(b).logout())},{default:i(()=>[g(" 注销 ")]),_:1})):f("",!0)]),_:1})]),_:1},8,["model"])]),_:1})),[[N,t(M)]])}}}),ce=re(se,[["__scopeId","data-v-0aa3686b"]]);export{ce as default};
