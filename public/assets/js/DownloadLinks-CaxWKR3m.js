import{b as M,J as h,r as j,e as i,f as c,c as m,n as a,l as n,x as s,t as v,k as P,F as q,C as I,q as d,E as u,A as J,O,N as R,T as G,P as H,p as K}from"./.pnpm-CR973naf.js";import{u as Q,i as W,a as X}from"./index-CG8uS_64.js";import{u as Y}from"./aria2Store-CIV4WswR.js";import{u as Z}from"./fileListStore-Kebr04RC.js";import{c as A}from"./copy-3KwjvvQT.js";const w=b=>new Promise(f=>setTimeout(f,b)),ee=d("h2",null,"链接列表",-1),te=d("h3",null,[s("下载请推荐使用Aria2下载器,如 "),d("a",{href:"https://motrix.app/"},"Motrix")],-1),ae=d("h3",null,"IDM下载需要手动指定UA,点击即可复制",-1),ne=d("h3",null,"如果当前链接下载失败,请尝试更换链接,如果全部不可用可以单独重新解析单个文件",-1),ce=M({__name:"DownloadLinks",setup(b){const f=Q(),{config:k}=h(f),x=Z(),{downloadLinks:p}=h(x),g=j([]),E=t=>g.value=t,S=Y(),{aria2ConfigForm:y,aria2ConfigDialogVisible:F}=h(S),D=async t=>{try{await W.post(`${y.value.host}:${y.value.port}/jsonrpc`,{jsonrpc:"2.0",id:X(),method:"aria2.addUri",params:[`token:${y.value.token}`,[t.urls?t.urls[t.index]:t.url],{out:t.filename,header:[`User-Agent: ${k.value.user_agent}`]}]})}catch{return u.error("发送失败, 请检查控制台输出, 自行谷歌搜索或提交issue")}u.success(`已把${t.filename}任务发送给下载器`)},L=async()=>{u.error("请确保最大同时下载文件数在5及以下,否则可能出现下载失败!"),await w(3e3),u.success("开始下载"),g.value.forEach(t=>D(t))},N=()=>F.value=!0,$=async(t,o)=>{const l=await x.getDownloadLinks(o,!0);if(!l)return u.error("重新解析失败");p.value[t]=l[0]},T=t=>{p.value[t].index++};return(t,o)=>{const l=J,U=O,r=R,z=G,B=H,V=K;return i(p).length!==0?(c(),m(V,{key:0,class:"card"},{default:a(()=>[ee,te,ae,ne,n(U,null,{default:a(()=>[n(l,{type:"primary",disabled:g.value.length<=0,onClick:o[0]||(o[0]=e=>L())},{default:a(()=>[s(" 批量下载 ")]),_:1},8,["disabled"]),n(l,{type:"primary",onClick:o[1]||(o[1]=e=>N())},{default:a(()=>[s("下载配置")]),_:1})]),_:1}),n(B,{border:"","show-overflow-tooltip":"",class:"table",data:i(p),onSelectionChange:E},{default:a(()=>[n(r,{type:"selection",width:"40"}),n(r,{prop:"ua",label:"UA"},{default:a(({})=>[n(z,{type:"danger",onClick:o[2]||(o[2]=e=>i(A)(i(k).user_agent,"已复制UA"))},{default:a(()=>[s(v(i(k).user_agent),1)]),_:1})]),_:1}),n(r,{prop:"filename",label:"文件名"}),n(r,{prop:"url",label:"下载链接"},{default:a(({row:e})=>[s(v(e.urls?e.urls[e.index]:e.url),1)]),_:1}),n(r,{label:"操作",width:"450"},{default:a(({row:e,$index:C})=>[n(l,{type:"primary",size:"small",onClick:_=>i(A)(e.urls?e.urls[e.index]:e.url,"已将链接复制到粘贴板内")},{default:a(()=>[s(" 复制链接 ")]),_:2},1032,["onClick"]),n(l,{type:"primary",size:"small",onClick:_=>D(e)},{default:a(()=>[s(" 发送Aria2 ")]),_:2},1032,["onClick"]),e.urls?(c(),P(q,{key:0},[e.index<e.urls.length-1?(c(),m(l,{key:0,type:"danger",size:"small",onClick:_=>T(C)},{default:a(()=>[s(" 更换链接 (当前第"+v(e.index+1)+"条链接) ",1)]),_:2},1032,["onClick"])):(c(),m(l,{key:1,type:"danger",size:"small",onClick:_=>$(C,e.fs_id)},{default:a(()=>[s(" 重新解析 ")]),_:2},1032,["onClick"]))],64)):(c(),m(l,{key:1,type:"danger",size:"small",onClick:_=>$(C,e.fs_id)},{default:a(()=>[s(" 重新解析 ")]),_:2},1032,["onClick"]))]),_:1})]),_:1},8,["data"])]),_:1})):I("",!0)}}});export{ce as default};
