import{b as T,$ as h,a0 as ee,r as v,e as y,c as E,m as a,k as l,x as _,w as c,j as L,F as N,_ as j,E as D,y as G,z as le,I as J,J as Z,B as ae,A as H,O as te,v as K,o as ne,q as x,t as z,a1 as V,C as R,S as se,Z as oe,U as de,a2 as ue}from"./.pnpm-DQd76FlD.js";import{i as S}from"./index-DHyaBMsj.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ie=d=>S.post("/admin/user",d),pe=d=>S.get(`/admin/user?page=${d.page}&size=${d.size}`),me=d=>S.patch(`/admin/user/${d.id}`,d),ce=d=>S.delete("/admin/user",{data:{user_ids:[d.id]}}),_e=d=>S.delete("/admin/user",{data:{user_ids:d}}),ve=T({__name:"AddUser",props:{modelValue:{},modelModifiers:{}},emits:h(["getUsers"],["update:modelValue"]),setup(d,{emit:p}){const k=p,b=ee(d,"modelValue"),f=v(!1),u=v({username:"",password:"",role:"user",inv_code_id:1}),m=v(null),I={username:[{required:!0,message:"请输入账户用户名",trigger:"blur"}],password:[{required:!0,message:"请输入账户密码",trigger:"blur"}]},M=async C=>{if(!(!C||!await C.validate()))try{f.value=!0,await ie(u.value),D.success("添加成功")}finally{f.value=!1}},F=C=>{k("getUsers"),C()},B=()=>{b.value=!1,k("getUsers")};return(C,s)=>{const g=G,$=le,t=J,o=Z,U=ae,i=H,A=te,w=K;return y(),E(A,{title:"添加用户",width:"60%",modelValue:b.value,"onUpdate:modelValue":s[6]||(s[6]=n=>b.value=n),"before-close":F},{footer:a(()=>[l(i,{type:"info",onClick:s[4]||(s[4]=n=>B())},{default:a(()=>[_("取消")]),_:1}),l(i,{type:"primary",onClick:s[5]||(s[5]=n=>M(m.value))},{default:a(()=>[_("添加")]),_:1})]),default:a(()=>[c((y(),E(U,{ref_key:"addUserFormRef",ref:m,model:u.value,rules:I,"label-width":"auto"},{default:a(()=>[l($,{label:"用户名",prop:"username"},{default:a(()=>[l(g,{modelValue:u.value.username,"onUpdate:modelValue":s[0]||(s[0]=n=>u.value.username=n)},null,8,["modelValue"])]),_:1}),l($,{label:"密码",prop:"password"},{default:a(()=>[l(g,{modelValue:u.value.password,"onUpdate:modelValue":s[1]||(s[1]=n=>u.value.password=n)},null,8,["modelValue"])]),_:1}),l($,{label:"权限",prop:"role"},{default:a(()=>[l(o,{modelValue:u.value.role,"onUpdate:modelValue":s[2]||(s[2]=n=>u.value.role=n)},{default:a(()=>[(y(),L(N,null,j(["user","admin"],n=>l(t,{key:n,label:n,value:n},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l($,{label:"邀请码ID",prop:"inv_code_id"},{default:a(()=>[l(g,{modelValue:u.value.inv_code_id,"onUpdate:modelValue":s[3]||(s[3]=n=>u.value.inv_code_id=n)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[w,f.value]])]),_:1},8,["modelValue"])}}}),fe=T({__name:"UserManagement",setup(d){const p=v(!1),k=v(15),b=v(1),f=v(),u=v([]),m=async()=>{try{p.value=!0;const t=await pe({page:b.value,size:k.value});f.value=t.data}finally{p.value=!1}},I=async t=>{t.edit=!(t.edit??!1)},M=async t=>{t.edit=!(t.edit??!0),await F(t)},F=async t=>{try{p.value=!0,await me(t),D.success("修改用户成功")}finally{p.value=!1,await m()}},B=async t=>{try{p.value=!0,await ce(t),D.success("删除用户成功")}finally{p.value=!1,await m()}},C=async()=>{try{p.value=!0;const t=u.value.map(o=>o.id);await _e(t),D.success("批量删除用户成功")}finally{p.value=!1,await m()}},s=t=>u.value=t;ne(m);const g=v(!1),$=()=>g.value=!g.value;return(t,o)=>{var O,q,P;const U=H,i=se,A=oe,w=G,n=J,Q=Z,W=de,X=ue,Y=K;return y(),L(N,null,[l(ve,{onGetUsers:m,modelValue:g.value,"onUpdate:modelValue":o[0]||(o[0]=e=>g.value=e)},null,8,["modelValue"]),l(U,{type:"primary",onClick:o[1]||(o[1]=e=>m())},{default:a(()=>[_("刷新列表")]),_:1}),l(U,{type:"primary",onClick:o[2]||(o[2]=e=>$())},{default:a(()=>[_("添加用户")]),_:1}),l(U,{type:"danger",disabled:u.value.length<=0,onClick:o[3]||(o[3]=e=>C())},{default:a(()=>[_(" 批量删除 ")]),_:1},8,["disabled"]),c((y(),E(W,{data:((O=f.value)==null?void 0:O.data)??[],border:"","show-overflow-tooltip":"",class:"table",onSelectionChange:s},{default:a(()=>[l(i,{type:"selection",width:"40"}),l(i,{prop:"id",label:"ID"}),l(i,{prop:"group.id",label:"用户组ID"}),l(i,{prop:"inv_code_id",label:"邀请码ID"},{default:a(({row:e})=>[c(x("span",null,z(e.inv_code_id),513),[[V,!e.edit]]),c(l(A,{modelValue:e.inv_code_id,"onUpdate:modelValue":r=>e.inv_code_id=r},null,8,["modelValue","onUpdate:modelValue"]),[[V,e.edit]])]),_:1}),l(i,{prop:"username",label:"用户名"},{default:a(({row:e})=>[c(x("span",null,z(e.username),513),[[V,!e.edit]]),c(l(w,{modelValue:e.username,"onUpdate:modelValue":r=>e.username=r},null,8,["modelValue","onUpdate:modelValue"]),[[V,e.edit]])]),_:1}),l(i,{prop:"password",label:"密码"},{default:a(({row:e})=>[c(x("span",null,z(e.password),513),[[V,!e.edit]]),c(l(w,{modelValue:e.password,"onUpdate:modelValue":r=>e.password=r},null,8,["modelValue","onUpdate:modelValue"]),[[V,e.edit]])]),_:1}),l(i,{prop:"role",label:"权限"},{default:a(({row:e})=>[c(x("span",null,z(e.role),513),[[V,!e.edit]]),c(l(Q,{modelValue:e.role,"onUpdate:modelValue":r=>e.role=r},{default:a(()=>[(y(),L(N,null,j(["user","admin"],r=>l(n,{key:r,label:r,value:r},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"]),[[V,e.edit]])]),_:1}),l(i,{prop:"created_at",label:"创建时间"},{default:a(({row:e})=>[_(z(new Date(e.created_at).toLocaleString()),1)]),_:1}),l(i,{prop:"updated_at",label:"更新时间"},{default:a(({row:e})=>[_(z(new Date(e.updated_at).toLocaleString()),1)]),_:1}),l(i,{width:"150",label:"操作",fixed:"right"},{default:a(({row:e})=>[e.edit?R("",!0):(y(),E(U,{key:0,size:"small",type:"primary",onClick:r=>I(e)},{default:a(()=>[_(" 编辑 ")]),_:2},1032,["onClick"])),e.edit?(y(),E(U,{key:1,size:"small",type:"primary",onClick:r=>M(e)},{default:a(()=>[_(" 保存 ")]),_:2},1032,["onClick"])):R("",!0),l(U,{size:"small",type:"danger",onClick:r=>B(e)},{default:a(()=>[_("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Y,p.value]]),l(X,{"current-page":b.value,"onUpdate:currentPage":o[4]||(o[4]=e=>b.value=e),"page-size":k.value,"onUpdate:pageSize":o[5]||(o[5]=e=>k.value=e),"page-sizes":[15,50,100,500,((q=f.value)==null?void 0:q.total)??100],total:((P=f.value)==null?void 0:P.total)??100,layout:"sizes, prev, pager, next",onSizeChange:m,onCurrentChange:m},null,8,["current-page","page-size","page-sizes","total"])],64)}}}),ye=re(fe,[["__scopeId","data-v-f0afc015"]]);export{ye as default};
