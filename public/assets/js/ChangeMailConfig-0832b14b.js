import"./base-9ed7a3b4.js";import{v as c}from"./el-loading-ea36553a.js";import{E as _,a as v}from"./el-form-item-a5242619.js";import{E as F}from"./el-button-3b2ee6a5.js";import{E as U}from"./el-input-feb7aa1f.js";import{E as q}from"./el-switch-67570869.js";import{d as y,r as S,a as E,m as N,o as R,P as k,u as l,e as A,R as H,w as i,b as o,q as V}from"./index-fee14184.js";import{f as h,g as x,h as B}from"./admin-b20f8c58.js";import{E as u}from"./request-56692d6c.js";import"./use-form-item-70fcde04.js";import"./_initCloneObject-6cd35402.js";import"./index-61ed4cec.js";import"./isNil-c75b1b34.js";import"./validator-3f44b6fb.js";const I=y("ChangeMailConfig",()=>{const g=S({mailSwitch:!1,mailTo:"",mailHost:"",mailPort:"",mailUsername:"",mailPassword:"",mailFromAddress:"",mailFromName:"",pending:!1}),s=S(null);return{changeMailConfigForm:g,changeMailConfigFormRef:s}}),ee=E({__name:"ChangeMailConfig",setup(g){const s=I(),{changeMailConfigForm:e,changeMailConfigFormRef:d}=N(s),w={mailSwitch:[{required:!0,message:"请确认是否开启",trigger:"blur"}],mailTo:[{required:!0,message:"请输入收件人",trigger:"blur"}],mailHost:[{required:!0,message:"请输入SMTP服务器地址",trigger:"blur"}],mailPort:[{required:!0,message:"请输入SMTP服务器端口",trigger:"blur"}],mailUsername:[{required:!0,message:"请输入SMTP服务器用户名",trigger:"blur"}],mailPassword:[{required:!0,message:"请输入SMTP服务器密码",trigger:"blur"}],mailFromAddress:[{required:!0,message:"请输入SMTP服务器发件邮箱",trigger:"blur"}],mailFromName:[{required:!0,message:"请输入SMTP服务器发件名",trigger:"blur"}]};R(async()=>await p());const p=async()=>{e.value.pending=!0;const t=await h()??"failed";e.value.pending=!1,t.toString()!=="failed"&&(e.value={...e.value,...t.data})},f=async t=>{if(!t||!await t.validate(()=>{}))return;e.value.pending=!0;const a=await x({...e.value})??"failed";e.value.pending=!1,a.toString()!=="failed"&&(u.success("修改成功"),await p())};async function P(t){if(!t||!await t.validate(()=>{}))return;await f(t),u.warning("如果发送失败没有看见错误信息请打开debug模式！"),e.value.pending=!0;const a=await B()??"failed";e.value.pending=!1,a.toString()!=="failed"&&(u.success("发送成功,请检查邮箱是否收到"),e.value.pending=!1)}return(t,a)=>{const C=q,n=_,m=U,M=F,T=v,b=c;return k((A(),H(T,{ref_key:"changeMailConfigFormRef",ref:d,model:l(e),rules:w,"label-width":"auto"},{default:i(()=>[o(n,{label:"是否开启",prop:"mailSwitch"},{default:i(()=>[o(C,{modelValue:l(e).mailSwitch,"onUpdate:modelValue":a[0]||(a[0]=r=>l(e).mailSwitch=r),size:"large"},null,8,["modelValue"])]),_:1}),o(n,{label:"收件人",prop:"mailTo"},{default:i(()=>[o(m,{modelValue:l(e).mailTo,"onUpdate:modelValue":a[1]||(a[1]=r=>l(e).mailTo=r)},null,8,["modelValue"])]),_:1}),o(n,{label:"SMTP服务器地址",prop:"mailHost"},{default:i(()=>[o(m,{modelValue:l(e).mailHost,"onUpdate:modelValue":a[2]||(a[2]=r=>l(e).mailHost=r)},null,8,["modelValue"])]),_:1}),o(n,{label:"SMTP服务器TLS端口",prop:"mailPort"},{default:i(()=>[o(m,{modelValue:l(e).mailPort,"onUpdate:modelValue":a[3]||(a[3]=r=>l(e).mailPort=r)},null,8,["modelValue"])]),_:1}),o(n,{label:"SMTP服务器用户名",prop:"mailUsername"},{default:i(()=>[o(m,{modelValue:l(e).mailUsername,"onUpdate:modelValue":a[4]||(a[4]=r=>l(e).mailUsername=r)},null,8,["modelValue"])]),_:1}),o(n,{label:"SMTP服务器密码",prop:"mailPassword"},{default:i(()=>[o(m,{modelValue:l(e).mailPassword,"onUpdate:modelValue":a[5]||(a[5]=r=>l(e).mailPassword=r)},null,8,["modelValue"])]),_:1}),o(n,{label:"SMTP服务器发件邮箱",prop:"mailFromAddress"},{default:i(()=>[o(m,{modelValue:l(e).mailFromAddress,"onUpdate:modelValue":a[6]||(a[6]=r=>l(e).mailFromAddress=r)},null,8,["modelValue"])]),_:1}),o(n,{label:"SMTP服务器发件名",prop:"mailFromName"},{default:i(()=>[o(m,{modelValue:l(e).mailFromName,"onUpdate:modelValue":a[7]||(a[7]=r=>l(e).mailFromName=r)},null,8,["modelValue"])]),_:1}),o(n,{label:" "},{default:i(()=>[o(M,{type:"primary",onClick:a[8]||(a[8]=r=>f(l(d))),loading:l(e).pending},{default:i(()=>[V(" 保存 ")]),_:1},8,["loading"]),o(M,{type:"primary",onClick:a[9]||(a[9]=r=>P(l(d))),loading:l(e).pending},{default:i(()=>[V(" 发送测试邮件 ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])),[[b,l(e).pending]])}}});export{ee as default};
