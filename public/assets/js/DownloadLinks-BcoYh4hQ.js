import{b as T,J as f,r as x,e as l,f as V,c as B,n as a,l as e,x as r,t as U,C as z,q as j,E as c,A as M,O as P,N as q,T as J,P as O,p as R}from"./.pnpm-BPJ2h7HZ.js";import{u as G,i as H,a as I}from"./index-BM65Q3ee.js";import{u as K}from"./aria2Store-CZxaBJ6B.js";import{u as Q}from"./fileListStore-DD8QAsCV.js";import{c as v}from"./copy-BEhOFPun.js";const W=g=>new Promise(u=>setTimeout(u,g)),X=j("h2",null,"链接列表",-1),oe=T({__name:"DownloadLinks",setup(g){const u=G(),{config:d}=f(u),k=Q(),{downloadLinks:p}=f(k),m=x([]),b=t=>m.value=t,w=K(),{aria2ConfigForm:_,aria2ConfigDialogVisible:$}=f(w),C=async t=>{try{await H.post(`${_.value.host}:${_.value.port}/jsonrpc`,{jsonrpc:"2.0",id:I(),method:"aria2.addUri",params:[`token:${_.value.token}`,[t.url],{out:t.filename,header:[`User-Agent: ${d.value.user_agent}`]}]})}catch{return c.error("发送失败, 请检查控制台输出, 自行谷歌搜索或提交issue")}c.success(`已把${t.filename}任务发送给下载器`)},h=async()=>{c.error("请确保最大同时下载文件数在5及以下,否则可能出现下载失败!"),await W(3e3),c.success("开始下载"),m.value.forEach(t=>C(t))},D=()=>$.value=!0,E=async(t,o)=>{const n=await k.getDownloadLinks(o,!0);if(!n)return c.error("重新解析失败");p.value[t]=n[0]};return(t,o)=>{const n=M,S=P,i=q,A=J,L=O,F=R;return l(p).length!==0?(V(),B(F,{key:0,class:"card"},{default:a(()=>[X,e(S,null,{default:a(()=>[e(n,{type:"primary",disabled:m.value.length<=0,onClick:o[0]||(o[0]=s=>h())},{default:a(()=>[r(" 批量下载 ")]),_:1},8,["disabled"]),e(n,{type:"primary",onClick:o[1]||(o[1]=s=>D())},{default:a(()=>[r("下载配置")]),_:1})]),_:1}),e(L,{border:"","show-overflow-tooltip":"",class:"table",data:l(p),onSelectionChange:b},{default:a(()=>[e(i,{type:"selection",width:"40"}),e(i,{prop:"ua",label:"UA"},{default:a(({})=>[e(A,{type:"danger",onClick:o[2]||(o[2]=s=>l(v)(l(d).user_agent,"已复制UA"))},{default:a(()=>[r(U(l(d).user_agent),1)]),_:1})]),_:1}),e(i,{prop:"filename",label:"文件名"}),e(i,{prop:"url",label:"下载链接"}),e(i,{label:"操作",width:"300"},{default:a(({row:s,$index:N})=>[e(n,{type:"primary",size:"small",onClick:y=>l(v)(s.url,"已将链接复制到粘贴板内")},{default:a(()=>[r(" 复制链接 ")]),_:2},1032,["onClick"]),e(n,{type:"primary",size:"small",onClick:y=>C(s)},{default:a(()=>[r(" 发送Aria2 ")]),_:2},1032,["onClick"]),e(n,{type:"danger",size:"small",onClick:y=>E(N,s.fs_id)},{default:a(()=>[r(" 重新解析 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})):z("",!0)}}});export{oe as default};
