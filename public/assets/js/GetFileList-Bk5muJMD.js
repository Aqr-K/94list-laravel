import{b as Z,J as h,o as D,L as I,E as $,u as T,w as G,e as t,f as i,c as d,n,q as P,t as q,C as c,l as a,x as g,k as J,F as W,M as j,y as H,z as K,A as O,B as Q,p as X,v as Y}from"./.pnpm-BPJ2h7HZ.js";import{u as ee}from"./fileListStore-D2ylG5Ly.js";import{u as te,a as le,g as C,c as se}from"./index-CDwOllFt.js";import{c as oe}from"./copy-BEhOFPun.js";import{f as re}from"./format-DaCfCw6f.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ne=Z({__name:"GetFileList",setup(ie){const w=ee(),{pending:M,getFileListForm:s,getFileListFormRef:k,selectedRows:E,limitForm:v,hitLimit:L}=h(w),b=te(),{config:y}=h(b),S=(l,e,r)=>e===""?r(new Error("请先输入需要解析的链接")):F(e)?r():r(new Error("请输入合法的链接")),A=()=>{s.value.dir="/",s.value.surl="";const l=F(s.value.url);l&&(l.id&&(l.surl?(s.value.url=`https://pan.baidu.com/share/init?surl=${l.id}`,s.value.surl=`1${l.id}`):(s.value.url=`https://pan.baidu.com/s/${l.id}`,s.value.surl=l.id)),l.pwd&&(s.value.pwd=l.pwd,$.success("已自动填写密码")))},F=l=>{const e=l.match(/s\/([a-zA-Z0-9_-]+)/),r=l.match(/surl=([a-zA-Z0-9_-]+)/),m=l.match(/\?pwd=([a-zA-Z0-9_-]+)/),p=l.match(/&pwd=([a-zA-Z0-9_-]+)/),u=l.match(/提取码:\s?([a-zA-Z0-9_-]+)/);let f;if(r)f=r[1];else if(e)f=e[1];else return!1;const _=m?m[1]:p?p[1]:u?u[1]:null;return r?{surl:!0,id:f,pwd:_}:{id:f,pwd:_}},B={url:[{required:!0,validator:S,trigger:"blur"}]},R=async l=>{if(!l||!await l.validate())return;const e=new URLSearchParams;e.set("url",s.value.url),e.set("surl",s.value.surl),e.set("pwd",s.value.pwd),e.set("dir",s.value.dir),oe(`${location.host}/?${e.toString()}`,"复制成功")};D(()=>{I(()=>{const l=new URLSearchParams(location.search);l.size<4||(s.value={url:l.get("url")??"",pwd:l.get("pwd")??"",dir:l.get("dir")??"/",surl:l.get("surl")??""},$.success("已读取到参数,正在加载"),setTimeout(w.getFileList,1e3))}),w.getLimit()});const V=T(),z=()=>V.push("/login"),U=()=>V.push("/admin");function x(){window.open("https://github.com/huankong233/94list-laravel")}return(l,e)=>{const r=j,m=H,p=K,u=O,f=Q,_=X,N=Y;return G((i(),d(_,null,{default:n(()=>[P("h2",null,"前台解析中心 | "+q(t(le)()),1),t(y).show_copyright?(i(),d(r,{key:0,"show-icon":"",type:"warning",closable:!1,title:"项目全部开源,开源地址: https://github.com/huankong233/94list-laravel",onClick:e[0]||(e[0]=o=>x()),class:"cursor"})):c("",!0),t(y).have_account?(i(),d(r,{key:1,closable:!1,class:"alert",title:"当前中转账号充足",type:"success"})):(i(),d(r,{key:2,closable:!1,class:"alert",title:"当前中转账号不足",type:"error"})),t(y).debug?(i(),d(r,{key:3,class:"alert",title:"当前网站开启了DEBUG模式,非调试请关闭!!!!",type:"error",closable:!1})):c("",!0),t(y).is_https?c("",!0):(i(),d(r,{key:4,class:"alert",title:"当前网站未开启SSL,可能出现无法请求Aria2服务器的问题",type:"error",closable:!1})),a(r,{class:"alert",type:t(L)?"error":"success",closable:!1,title:t(L)?"当前用户配额已用完":`当前用户组: ${t(v).group_name} 当前剩余解析文件数: ${t(v).count} 当前剩余解析大小: ${t(re)(t(v).size)}`},null,8,["type","title"]),a(f,{ref_key:"getFileListFormRef",ref:k,model:t(s),rules:B,"label-width":"auto",class:"form"},{default:n(()=>[a(p,{label:"链接",prop:"url"},{default:n(()=>[a(m,{modelValue:t(s).url,"onUpdate:modelValue":e[1]||(e[1]=o=>t(s).url=o),modelModifiers:{trim:!0},onBlur:e[2]||(e[2]=o=>A())},null,8,["modelValue"])]),_:1}),a(p,{label:"密码",prop:"pwd"},{default:n(()=>[a(m,{modelValue:t(s).pwd,"onUpdate:modelValue":e[3]||(e[3]=o=>t(s).pwd=o),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),t(y).need_password?(i(),d(p,{key:0,label:"解析密码",prop:"password"},{default:n(()=>[a(m,{modelValue:t(s).password,"onUpdate:modelValue":e[4]||(e[4]=o=>t(s).password=o),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1})):c("",!0),a(p,{label:"当前路径",prop:"dir"},{default:n(()=>[a(m,{modelValue:t(s).dir,"onUpdate:modelValue":e[5]||(e[5]=o=>t(s).dir=o),disabled:""},null,8,["modelValue"])]),_:1}),a(p,{label:" "},{default:n(()=>[a(u,{type:"primary",onClick:e[6]||(e[6]=o=>t(w).getFileList())},{default:n(()=>[g("获取/刷新列表")]),_:1}),a(u,{type:"primary",disabled:t(E).length<=0,onClick:e[7]||(e[7]=o=>t(w).getDownloadLinks())},{default:n(()=>[g(" 批量解析 ")]),_:1},8,["disabled"]),a(u,{type:"primary",onClick:e[8]||(e[8]=o=>R(t(k)))},{default:n(()=>[g("复制当前地址")]),_:1}),t(C)()==="0"?(i(),d(u,{key:0,type:"primary",onClick:e[9]||(e[9]=o=>z())},{default:n(()=>[g("登陆")]),_:1})):c("",!0),t(C)()==="1"?(i(),J(W,{key:1},[t(se)()==="admin"?(i(),d(u,{key:0,type:"primary",onClick:e[10]||(e[10]=o=>U())},{default:n(()=>[g(" 进入后台 ")]),_:1})):c("",!0),a(u,{type:"danger",onClick:e[11]||(e[11]=o=>t(b).logout())},{default:n(()=>[g(" 注销 ")]),_:1})],64)):c("",!0)]),_:1})]),_:1},8,["model"])]),_:1})),[[N,t(M)]])}}}),ge=ae(ne,[["__scopeId","data-v-80044379"]]);export{ge as default};
