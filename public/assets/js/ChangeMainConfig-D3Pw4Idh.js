import{b as E,r as v,o as M,w as A,f as F,c as $,n as t,l,x as w,E as f,y as k,z as q,V as B,W as N,X as I,Y as R,A as D,B as L,v as S}from"./.pnpm-CR973naf.js";import{i as g,n as G}from"./index-DDddeY1G.js";const O=()=>g.get("/admin/config/main"),T=s=>g.patch("/admin/config/main",s),W=s=>g.post("/admin/config/main/testAuth",s),j=E({__name:"ChangeMainConfig",setup(s){const d=v(!1),a=v({front_end_version:"",version:"",sleep:0,max_once:0,password:"",announce:"",user_agent:"",need_inv_code:!1,whitelist_mode:!1,debug:!1,name:"",code:"",main_server:"",show_copyright:!1,parse_mode:1,custom_copyright:"本项目半开源, 项目地址: https://github.com/huankong233/94list-laravel",max_filesize:0}),m=v(null),y={name:[{required:!0,message:"请输入站点名称",trigger:"blur"}],sleep:[{required:!0,message:"请输入批量解析时休眠时间(秒)",trigger:"blur"}],max_once:[{required:!0,message:"请输入批量解析时单次最大解析数量",trigger:"blur"}],max_filesize:[{required:!0,message:"请输入单日单个账号最大解析大小",trigger:"blur"}],user_agent:[{required:!0,message:"请输入User_Agent",trigger:"blur"}]},p=async()=>{try{d.value=!0;const e=(await O()).data;a.value={...e,front_end_version:await G(),announce:e.announce.replaceAll("[NextLine]",`
`)}}finally{d.value=!1}},c=async r=>{if(!(!r||!await r.validate()))try{d.value=!0,await T(a.value),f.success("保存成功")}finally{d.value=!1,await p()}},U=async r=>{if(!(!r||!await r.validate()))try{d.value=!0;const e=await W(a.value);"ip"in e.data?f.error(`未知授权码,当前ip为: ${e.data.ip}`):f.success(`测试通过,有效期至: ${e.data.expired_at}`)}finally{d.value=!1,await p()}};return M(p),(r,e)=>{const u=k,n=q,i=B,_=N,V=I,x=R,b=D,C=L,z=S;return A((F(),$(C,{ref_key:"changeConfigFormRef",ref:m,model:a.value,rules:y,"label-width":"auto"},{default:t(()=>[l(n,{label:"前端版本号",prop:"front_end_version"},{default:t(()=>[l(u,{disabled:"",modelValue:a.value.front_end_version,"onUpdate:modelValue":e[0]||(e[0]=o=>a.value.front_end_version=o)},null,8,["modelValue"])]),_:1}),l(n,{label:"后端版本号",prop:"version"},{default:t(()=>[l(u,{disabled:"",modelValue:a.value.version,"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.version=o)},null,8,["modelValue"])]),_:1}),l(n,{label:"DEBUG模式开关",prop:"debug"},{default:t(()=>[l(i,{modelValue:a.value.debug,"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.debug=o),size:"large"},null,8,["modelValue"])]),_:1}),l(n,{label:"邀请码开关",prop:"need_inv_code"},{default:t(()=>[l(i,{modelValue:a.value.need_inv_code,"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.need_inv_code=o),size:"large"},null,8,["modelValue"])]),_:1}),l(n,{label:"白名单模式开关",prop:"whitelist_mode"},{default:t(()=>[l(i,{modelValue:a.value.whitelist_mode,"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.whitelist_mode=o),size:"large"},null,8,["modelValue"])]),_:1}),l(n,{label:"站点名称",prop:"name"},{default:t(()=>[l(u,{modelValue:a.value.name,"onUpdate:modelValue":e[5]||(e[5]=o=>a.value.name=o),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),l(n,{label:"下载使用的 User_Agent",prop:"user_agent"},{default:t(()=>[l(u,{modelValue:a.value.user_agent,"onUpdate:modelValue":e[6]||(e[6]=o=>a.value.user_agent=o),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),l(n,{label:"批量解析时休眠时间(秒)",prop:"sleep"},{default:t(()=>[l(_,{modelValue:a.value.sleep,"onUpdate:modelValue":e[7]||(e[7]=o=>a.value.sleep=o)},null,8,["modelValue"])]),_:1}),l(n,{label:"批量解析时单次最大解析数量",prop:"max_once"},{default:t(()=>[l(_,{modelValue:a.value.max_once,"onUpdate:modelValue":e[8]||(e[8]=o=>a.value.max_once=o)},null,8,["modelValue"])]),_:1}),l(n,{label:"单日单个账号最大解析大小(bit)",prop:"max_filesize"},{default:t(()=>[l(_,{modelValue:a.value.max_filesize,"onUpdate:modelValue":e[9]||(e[9]=o=>a.value.max_filesize=o),style:{width:"200px"}},null,8,["modelValue"])]),_:1}),l(n,{label:"公告内容",prop:"announce"},{default:t(()=>[l(u,{type:"textarea",modelValue:a.value.announce,"onUpdate:modelValue":e[10]||(e[10]=o=>a.value.announce=o)},null,8,["modelValue"])]),_:1}),l(n,{label:"密码",prop:"password"},{default:t(()=>[l(u,{modelValue:a.value.password,"onUpdate:modelValue":e[11]||(e[11]=o=>a.value.password=o),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),l(n,{label:"授权服务器",prop:"main_server"},{default:t(()=>[l(u,{modelValue:a.value.main_server,"onUpdate:modelValue":e[12]||(e[12]=o=>a.value.main_server=o),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),l(n,{label:"授权码",prop:"code"},{default:t(()=>[l(u,{modelValue:a.value.code,"onUpdate:modelValue":e[13]||(e[13]=o=>a.value.code=o),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),l(n,{label:"展示版权",prop:"show_copyright"},{default:t(()=>[l(i,{modelValue:a.value.show_copyright,"onUpdate:modelValue":e[14]||(e[14]=o=>a.value.show_copyright=o),size:"large"},null,8,["modelValue"])]),_:1}),l(n,{label:"自定义版权",prop:"custom_copyright"},{default:t(()=>[l(u,{modelValue:a.value.custom_copyright,"onUpdate:modelValue":e[15]||(e[15]=o=>a.value.custom_copyright=o)},null,8,["modelValue"])]),_:1}),l(n,{label:"解析模式",prop:"parse_mode"},{default:t(()=>[l(x,{modelValue:a.value.parse_mode,"onUpdate:modelValue":e[16]||(e[16]=o=>a.value.parse_mode=o)},{default:t(()=>[l(V,{value:1,label:"盘内"}),l(V,{value:2,label:"盘外(老)"})]),_:1},8,["modelValue"])]),_:1}),l(n,{label:" "},{default:t(()=>[l(b,{type:"primary",onClick:e[17]||(e[17]=o=>c(m.value))},{default:t(()=>[w("保存")]),_:1}),l(b,{type:"primary",onClick:e[18]||(e[18]=o=>U(m.value))},{default:t(()=>[w("测试授权")]),_:1})]),_:1})]),_:1},8,["model"])),[[z,d.value]])}}});export{j as default};
