import{g as y,j as V}from"./request-3b809520.js";import{E as b}from"./el-overlay-45f8e01a.js";import{E as w,a as E}from"./el-form-item-711f284c.js";import{E as I}from"./el-input-d306da18.js";import{d as T,A as C,o as F,a as P,w as n,l as t,f as a,k as p,D as x}from"./index-e0a4a1cf.js";import{u as M}from"./AccountManagement-5dd97aa1.js";import{g as R,c as D}from"./admin-7bfe4b8d.js";import"./el-text-2a4c1966.js";import"./focus-trap-56a67a6b.js";const H=T({__name:"AddAccount",setup(U){const i=M(),{addAccountForm:e,addAccountFormRef:u,addAccountFormVisible:r}=C(i),f=async d=>{if(d&&await d.validate(()=>{})){e.value.addPending=!0;const o=await R({cookie:e.value.cookie.trim()}).catch(()=>{e.value.checkedInfo=!1,e.value.username="",e.value.vipType=""})??"failed";e.value.addPending=!1,o!=="failed"&&(i.closeAddDialog(),y.success("添加成功"),await i.getAccounts())}},v={cookie:[{required:!0,message:"请输入账户Cookie",trigger:"blur"}]},g=new Map([[0,"普通用户"],[1,"普通会员"],[2,"超级会员"]]),k=async()=>{if(!u.value||!await u.value.validate(()=>{}))return;e.value.checkPending=!0;const d=await D({cookie:e.value.cookie.trim()})??"failed";if(e.value.checkPending=!1,d==="failed")return;const{data:o}=d;e.value.checkedInfo=!0,e.value.username=o.baidu_name,e.value.vipType=g.get(o.vip_type)??"普通用户"};return(d,o)=>{const s=I,c=w,_=E,m=V,A=b;return F(),P(A,{modelValue:a(r),"onUpdate:modelValue":o[5]||(o[5]=l=>x(r)?r.value=l:null),title:"添加代理账号",width:"60%"},{footer:n(()=>[t(m,{type:"info",onClick:o[3]||(o[3]=l=>a(i).closeAddDialog())},{default:n(()=>[p("取消")]),_:1}),t(m,{type:"primary",onClick:k,disabled:a(e).checkedInfo,loading:a(e).checkPending},{default:n(()=>[p(" 获取账户信息 ")]),_:1},8,["disabled","loading"]),t(m,{type:"primary",onClick:o[4]||(o[4]=l=>f(a(u))),disabled:!a(e).checkedInfo,loading:a(e).addPending},{default:n(()=>[p(" 添加 ")]),_:1},8,["disabled","loading"])]),default:n(()=>[t(_,{ref_key:"addAccountFormRef",ref:u,model:a(e),rules:v,"label-width":"auto"},{default:n(()=>[t(c,{label:"账户Cookie",prop:"cookie"},{default:n(()=>[t(s,{type:"textarea",modelValue:a(e).cookie,"onUpdate:modelValue":o[0]||(o[0]=l=>a(e).cookie=l),rows:"5"},null,8,["modelValue"])]),_:1}),t(c,{label:"账号名称",prop:"username"},{default:n(()=>[t(s,{modelValue:a(e).username,"onUpdate:modelValue":o[1]||(o[1]=l=>a(e).username=l),disabled:""},null,8,["modelValue"])]),_:1}),t(c,{label:"账号等级",prop:"vipType"},{default:n(()=>[t(s,{modelValue:a(e).vipType,"onUpdate:modelValue":o[2]||(o[2]=l=>a(e).vipType=l),disabled:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}});export{H as default};
