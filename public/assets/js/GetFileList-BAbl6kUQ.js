import{b as U,K as V,o as x,L as z,E as k,n as B,w as N,u as r,e as m,c,m as n,q as Z,t as D,B as v,k as s,s as g,M as I,x as T,y as G,z as P,A as q,p as K,v as j}from"./.pnpm-iATkil5N.js";import{u as H}from"./fileListStore-CTfzH0o3.js";import{u as J,a as O}from"./index-ctO0osHI.js";import{c as Q}from"./copy-CBlLxS-i.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";const X=U({__name:"GetFileList",setup(Y){const f=H(),{pending:b,getFileListForm:l,getFileListFormRef:y,selectedRows:F}=V(f),M=J(),{config:_}=V(M),h=(t,e,o)=>e===""?o(new Error("请先输入需要解析的链接")):L(e)?o():o(new Error("请输入合法的链接")),E=()=>{l.value.dir="/",l.value.surl="";const t=L(l.value.url);t&&(t.id&&(t.surl?l.value.url=`https://pan.baidu.com/share/init?surl=${t.id}`:l.value.url=`https://pan.baidu.com/s/${t.id}`,l.value.surl=t.id),t.pwd&&(l.value.pwd=t.pwd,k.success("已自动填写密码")))},L=t=>{const e=t.match(/s\/([a-zA-Z0-9_-]+)/),o=t.match(/surl=([a-zA-Z0-9_-]+)/),u=t.match(/\?pwd=([a-zA-Z0-9_-]+)/),i=t.match(/&pwd=([a-zA-Z0-9_-]+)/),d=t.match(/提取码:\s?([a-zA-Z0-9_-]+)/);let p;if(o)p=o[1];else if(e)p=e[1];else return!1;const w=u?u[1]:i?i[1]:d?d[1]:null;return o?{surl:!0,id:p,pwd:w}:{id:p,pwd:w}},S={url:[{required:!0,validator:h,trigger:"blur"}]},A=async t=>{if(!t||!await t.validate())return;const e=new URLSearchParams;e.set("url",l.value.url),e.set("surl",l.value.surl),e.set("pwd",l.value.pwd),e.set("dir",l.value.dir),Q(`${location.host}/?${e.toString()}`,"复制成功")};x(()=>{z(()=>{const t=new URLSearchParams(location.search);t.size<4||(l.value={url:t.get("url")??"",pwd:t.get("pwd")??"",dir:t.get("dir")??"/",surl:t.get("surl")??""},k.success("已读取到参数,正在加载"),setTimeout(()=>f.getFileList(),1e3))})});const $=B(),C=()=>$.push("/login");return(t,e)=>{const o=I,u=T,i=G,d=P,p=q,w=K,R=j;return N((m(),c(w,null,{default:n(()=>[Z("h2",null,"前台解析中心 | "+D(r(O)()),1),r(_).have_account?(m(),c(o,{key:0,title:"当前中转账号充足",type:"success"})):(m(),c(o,{key:1,title:"当前中转账号不足",type:"error"})),r(_).debug?(m(),c(o,{key:2,class:"alert",title:"当前网站开启了DEBUG模式,非调试请关闭!!!!",type:"error"})):v("",!0),r(_).is_https?v("",!0):(m(),c(o,{key:3,class:"alert",title:"当前网站未开启SSL,可能出现无法请求Aria2服务器的问题",type:"error"})),s(p,{ref_key:"getFileListFormRef",ref:y,model:r(l),rules:S,"label-width":"auto",class:"form"},{default:n(()=>[s(i,{label:"链接",prop:"url"},{default:n(()=>[s(u,{modelValue:r(l).url,"onUpdate:modelValue":e[0]||(e[0]=a=>r(l).url=a),modelModifiers:{trim:!0},onBlur:e[1]||(e[1]=a=>E())},null,8,["modelValue"])]),_:1}),s(i,{label:"密码",prop:"pwd"},{default:n(()=>[s(u,{modelValue:r(l).pwd,"onUpdate:modelValue":e[2]||(e[2]=a=>r(l).pwd=a),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),r(_).need_password?(m(),c(i,{key:0,label:"解析密码",prop:"password"},{default:n(()=>[s(u,{modelValue:r(l).password,"onUpdate:modelValue":e[3]||(e[3]=a=>r(l).password=a),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1})):v("",!0),s(i,{label:"当前路径",prop:"dir"},{default:n(()=>[s(u,{modelValue:r(l).dir,"onUpdate:modelValue":e[4]||(e[4]=a=>r(l).dir=a),disabled:""},null,8,["modelValue"])]),_:1}),s(i,{label:" "},{default:n(()=>[s(d,{type:"primary",onClick:e[5]||(e[5]=a=>r(f).getFileList())},{default:n(()=>[g("获取文件列表")]),_:1}),s(d,{type:"primary",disabled:r(F).length<=0,onClick:e[6]||(e[6]=a=>r(f).getDownloadLinks())},{default:n(()=>[g(" 批量解析 ")]),_:1},8,["disabled"]),s(d,{type:"primary",onClick:e[7]||(e[7]=a=>A(r(y)))},{default:n(()=>[g("复制当前地址")]),_:1}),s(d,{type:"primary",onClick:e[8]||(e[8]=a=>C())},{default:n(()=>[g("登陆")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})),[[R,r(b)]])}}}),oe=W(X,[["__scopeId","data-v-cbfea3b5"]]);export{oe as default};
