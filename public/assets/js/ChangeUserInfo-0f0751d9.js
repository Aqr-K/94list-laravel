import{g as i,j as _}from"./request-40fd0d0c.js";import{E as I,a as V}from"./el-form-item-fd71e1d8.js";import{E as b}from"./el-input-b13a7281.js";import{y as v,r as w,d as F,I as C,A as h,o as E,a as R,w as a,l as r,f as n,k,N as x}from"./index-33ed1e89.js";import{f as y}from"./admin-758ddfa7.js";const S=v("ChangeUserInfo",()=>{const m=w({nowPassword:"",newPassword:"",confirmPassword:"",newUsername:"",pending:!1}),d=w(null);return{changeUserInfoForm:m,changeUserInfoFormRef:d}}),A=F({__name:"ChangeUserInfo",setup(m){const d=C(),p=S(),{changeUserInfoForm:e,changeUserInfoFormRef:f}=h(p),g={nowPassword:[{required:!0,message:"请输入旧密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"}]},c=async u=>{if(u&&await u.validate(()=>{})){if(e.value.newPassword!==e.value.confirmPassword){i.error("两次密码不一致");return}e.value.pending=!0;const o=await y({...e.value,newUsername:e.value.newUsername??""})??"failed";if(e.value.pending=!1,o.toString()==="failed")return;e.value={newUsername:"",nowPassword:"",newPassword:"",confirmPassword:"",pending:!1},i.success("修改成功"),x("0"),d.push("/login")}};return(u,o)=>{const t=b,l=I,U=_,P=V;return E(),R(P,{ref_key:"changeUserInfoFormRef",ref:f,model:n(e),rules:g,"label-width":"200px"},{default:a(()=>[r(l,{label:"新的用户名(为空就是不改)",prop:"newUsername"},{default:a(()=>[r(t,{modelValue:n(e).newUsername,"onUpdate:modelValue":o[0]||(o[0]=s=>n(e).newUsername=s)},null,8,["modelValue"])]),_:1}),r(l,{label:"旧密码",prop:"nowPassword"},{default:a(()=>[r(t,{modelValue:n(e).nowPassword,"onUpdate:modelValue":o[1]||(o[1]=s=>n(e).nowPassword=s)},null,8,["modelValue"])]),_:1}),r(l,{label:"新密码",prop:"newPassword"},{default:a(()=>[r(t,{modelValue:n(e).newPassword,"onUpdate:modelValue":o[2]||(o[2]=s=>n(e).newPassword=s)},null,8,["modelValue"])]),_:1}),r(l,{label:"确认新密码",prop:"confirmPassword"},{default:a(()=>[r(t,{modelValue:n(e).confirmPassword,"onUpdate:modelValue":o[3]||(o[3]=s=>n(e).confirmPassword=s)},null,8,["modelValue"])]),_:1}),r(l,null,{default:a(()=>[r(U,{type:"primary",onClick:o[4]||(o[4]=s=>c(n(f))),disabled:n(e).pending,loading:n(e).pending},{default:a(()=>[k(" 提交 ")]),_:1},8,["disabled","loading"])]),_:1})]),_:1},8,["model"])}}});export{A as default};
