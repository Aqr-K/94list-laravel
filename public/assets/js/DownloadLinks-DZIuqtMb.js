import{b as F,J as y,r as N,e as u,f as T,c as x,n as t,l as e,x as s,t as V,C as B,q as U,E as i,A as z,O as j,N as P,T as q,P as J,p as M}from"./.pnpm-TARA5JeW.js";import{i as O,a as R}from"./index--d9Pblwj.js";import{u as G}from"./aria2Store-BMSAJSmT.js";import{u as H}from"./fileListStore-BYm1sobl.js";import{c as g}from"./copy-BsygMIAv.js";const I=_=>new Promise(c=>setTimeout(c,_)),K=U("h2",null,"链接列表",-1),ee=F({__name:"DownloadLinks",setup(_){const c=H(),{downloadLinks:d}=y(c),p=N([]),b=a=>p.value=a,v=G(),{aria2ConfigForm:m,aria2ConfigDialogVisible:h}=y(v),f=async a=>{try{await O.post(`${m.value.host}:${m.value.port}/jsonrpc`,{jsonrpc:"2.0",id:R(),method:"aria2.addUri",params:[`token:${m.value.token}`,[a.url],{out:a.filename,header:[`User-Agent: ${a.ua}`]}]})}catch{return i.error("发送失败, 请检查控制台输出, 自行谷歌搜索或提交issue")}i.success(`已把${a.filename}任务发送给下载器`)},w=async()=>{i.error("请确保最大同时下载文件数在5及以下,否则可能出现下载失败!"),await I(3e3),i.success("开始下载"),p.value.forEach(a=>f(a))},$=()=>h.value=!0,D=async(a,l)=>{const o=await c.getDownloadLinks(l,!0);if(!o)return i.error("重新解析失败");d.value[a]=o[0]};return(a,l)=>{const o=z,E=j,r=P,A=q,L=J,S=M;return u(d).length!==0?(T(),x(S,{key:0,class:"card"},{default:t(()=>[K,e(E,null,{default:t(()=>[e(o,{type:"primary",disabled:p.value.length<=0,onClick:l[0]||(l[0]=n=>w())},{default:t(()=>[s(" 批量下载 ")]),_:1},8,["disabled"]),e(o,{type:"primary",onClick:l[1]||(l[1]=n=>$())},{default:t(()=>[s("下载配置")]),_:1})]),_:1}),e(L,{border:"","show-overflow-tooltip":"",class:"table",data:u(d),onSelectionChange:b},{default:t(()=>[e(r,{type:"selection",width:"40"}),e(r,{prop:"ua",label:"UA"},{default:t(({row:n})=>[e(A,{type:"danger",onClick:k=>u(g)(n.ua,"已复制UA")},{default:t(()=>[s(V(n.ua),1)]),_:2},1032,["onClick"])]),_:1}),e(r,{prop:"filename",label:"文件名"}),e(r,{prop:"url",label:"下载链接"}),e(r,{label:"操作",width:"270"},{default:t(({row:n,$index:k})=>[e(o,{type:"primary",size:"small",onClick:C=>u(g)(n.url,"已将链接复制到粘贴板内")},{default:t(()=>[s(" 复制链接 ")]),_:2},1032,["onClick"]),e(o,{type:"primary",size:"small",onClick:C=>f(n)},{default:t(()=>[s(" 发送Aria2 ")]),_:2},1032,["onClick"]),e(o,{type:"danger",size:"small",onClick:C=>D(k,n.fs_id)},{default:t(()=>[s(" 重新解析 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})):B("",!0)}}});export{ee as default};
