import{b as U,K as V,o as z,E as k,n as B,w as x,u as o,e as m,c,m as n,q as I,t as N,B as v,k as r,s as g,L as Z,x as D,y as G,z as T,A as q,p as P,v as K}from"./.pnpm-Mf6j6NBF.js";import{u as j}from"./fileListStore-B87h874s.js";import{u as H,a as J}from"./index-DGLImKVB.js";import{c as O}from"./copy-XQPzqq6X.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const W=U({__name:"GetFileList",setup(X){const f=j(),{pending:F,getFileListForm:l,getFileListFormRef:y,selectedRows:b}=V(f),$=H(),{config:_}=V($),M=(e,t,s)=>t===""?s(new Error("请先输入需要解析的链接")):L(t)?s():s(new Error("请输入合法的链接")),E=()=>{const e=L(l.value.url);e&&(e.id&&(e.surl?l.value.url=`https://pan.baidu.com/share/init?surl=${e.id}`:l.value.url=`https://pan.baidu.com/s/${e.id}`,l.value.surl=e.id),e.pwd&&(l.value.pwd=e.pwd,k.success("已自动填写密码")))},L=e=>{const t=e.match(/s\/([a-zA-Z0-9_-]+)/),s=e.match(/surl=([a-zA-Z0-9_-]+)/),u=e.match(/\?pwd=([a-zA-Z0-9_-]+)/),i=e.match(/&pwd=([a-zA-Z0-9_-]+)/),d=e.match(/提取码:\s?([a-zA-Z0-9_-]+)/);let p;if(s)p=s[1];else if(t)p=t[1];else return!1;const w=u?u[1]:i?i[1]:d?d[1]:null;return s?{surl:!0,id:p,pwd:w}:{id:p,pwd:w}},h={url:[{required:!0,validator:M,trigger:"blur"}]},A=async e=>{!e||!await e.validate()||O(`${location.host}/?url=${l.value.url}&surl=${l.value.surl}&pwd=${l.value.pwd}&dir=${encodeURIComponent(l.value.dir)}`,"复制成功")};z(()=>{const e=new URLSearchParams(location.search);e.size<4||(l.value.url=e.get("url")??"",l.value.pwd=e.get("pwd")??"",l.value.dir=e.get("dir")??"/",l.value.surl=e.get("surl")??"",k.success("已读取到参数,正在加载"),setTimeout(()=>f.getFileList(),1e3))});const C=B(),R=()=>C.push("/login");return(e,t)=>{const s=Z,u=D,i=G,d=T,p=q,w=P,S=K;return x((m(),c(w,null,{default:n(()=>[I("h2",null,"前台解析中心 | "+N(o(J)()),1),o(_).have_account?(m(),c(s,{key:0,title:"当前中转账号充足",type:"success"})):(m(),c(s,{key:1,title:"当前中转账号不足",type:"error"})),o(_).debug?(m(),c(s,{key:2,class:"alert",title:"当前网站开启了DEBUG模式,非调试请关闭!!!!",type:"error"})):v("",!0),o(_).is_https?v("",!0):(m(),c(s,{key:3,class:"alert",title:"当前网站未开启SSL,可能出现无法请求Aria2服务器的问题",type:"error"})),r(p,{ref_key:"getFileListFormRef",ref:y,model:o(l),rules:h,"label-width":"auto",class:"form"},{default:n(()=>[r(i,{label:"链接",prop:"url"},{default:n(()=>[r(u,{modelValue:o(l).url,"onUpdate:modelValue":t[0]||(t[0]=a=>o(l).url=a),modelModifiers:{trim:!0},onBlur:t[1]||(t[1]=a=>E())},null,8,["modelValue"])]),_:1}),r(i,{label:"密码",prop:"pwd"},{default:n(()=>[r(u,{modelValue:o(l).pwd,"onUpdate:modelValue":t[2]||(t[2]=a=>o(l).pwd=a),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),o(_).need_password?(m(),c(i,{key:0,label:"解析密码",prop:"password"},{default:n(()=>[r(u,{modelValue:o(l).password,"onUpdate:modelValue":t[3]||(t[3]=a=>o(l).password=a),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1})):v("",!0),r(i,{label:"当前路径",prop:"dir"},{default:n(()=>[r(u,{modelValue:o(l).dir,"onUpdate:modelValue":t[4]||(t[4]=a=>o(l).dir=a),disabled:""},null,8,["modelValue"])]),_:1}),r(i,{label:" "},{default:n(()=>[r(d,{type:"primary",onClick:t[5]||(t[5]=a=>o(f).getFileList())},{default:n(()=>[g("获取文件列表")]),_:1}),r(d,{type:"primary",disabled:o(b).length<=0,onClick:t[6]||(t[6]=a=>o(f).getDownloadLinks())},{default:n(()=>[g(" 批量解析 ")]),_:1},8,["disabled"]),r(d,{type:"primary",onClick:t[7]||(t[7]=a=>A(o(y)))},{default:n(()=>[g("复制当前地址")]),_:1}),r(d,{type:"primary",onClick:t[8]||(t[8]=a=>R())},{default:n(()=>[g("登陆")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})),[[S,o(F)]])}}}),re=Q(W,[["__scopeId","data-v-9e59300f"]]);export{re as default};
