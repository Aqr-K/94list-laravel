import{e as F,f as x,h as D,j as P}from"./index-BcjYLXzc.js";import{d as S,r as s,E as n}from"./.pnpm-CR973naf.js";const z=S("fileListStore",()=>{const t=s(!1),i=s({surl:"",url:"",pwd:"",dir:"/",password:""}),d=s(null),L=()=>{const e=i.value.dir.split("/");e.pop();const c=e.join("/");return c===""?"/":c},k=async()=>{if(!(!d.value||!await d.value.validate())){if(i.value.surl==="")return n.error("获取链接surl失败");try{u.value=[],t.value=!0;const e=await F(i.value);r.value=e.data,i.value.dir!=="/"&&r.value.list.unshift({category:-1,fs_id:0,isdir:1,local_ctime:0,local_mtime:0,server_ctime:0,server_mtime:0,size:0,md5:"",path:L(),server_filename:"..",dlink:""}),n.success("获取文件列表成功")}finally{t.value=!1}}},l=s({hit_captcha:!1,vcode_str:"",vcode_img:"",vcode_input:""}),r=s({uk:0,shareid:0,randsk:"",list:[]}),u=s([]),p=s([]),y=async(e,c=!1)=>{if(t.value){n.info("请勿重复点击~");return}const _=e?[e]:u.value.filter(a=>a.isdir!==1).map(a=>a.fs_id);e===void 0&&_.length!==u.value.length&&n.error("文件夹不会被解析!");let m;try{t.value=!0;const a={uk:r.value.uk,shareid:r.value.shareid,randsk:r.value.randsk,fs_ids:_,password:i.value.password,url:i.value.url};if(l.value.hit_captcha&&(a.vcode_str=l.value.vcode_str,a.vcode_input=l.value.vcode_input),m=await x(a),n.success("解析成功,下载链接请下滑"),c)return t.value=!1,await f(),m.data.map(o=>({...o,index:0}));p.value=m.data.map(o=>({...o,index:0})),l.value={hit_captcha:!1,vcode_str:"",vcode_img:"",vcode_input:""}}catch(a){const{code:o,message:h}=a;if(o&&h&&h.includes("验证码")){const w=await D();l.value={hit_captcha:!0,vcode_str:w.data.vcode,vcode_img:w.data.img,vcode_input:""}}}finally{t.value=!1,await f()}},g=s({group_name:"",count:0,size:0}),v=s(!1),f=async()=>{try{t.value=!0;const e=await P();g.value=e.data,v.value=!1}catch{v.value=!0}finally{t.value=!1}};return{pending:t,fileList:r,getFileList:k,getFileListForm:i,getFileListFormRef:d,selectedRows:u,downloadLinks:p,getDownloadLinks:y,limitForm:g,getLimit:f,hitLimit:v,vcode:l}});export{z as u};
