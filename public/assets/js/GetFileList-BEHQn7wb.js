import{b as K,r as E,J as U,o as O,L as Q,E as A,u as W,w as X,e,f as i,c as p,n as a,q as x,t as Y,C as f,l as r,k as R,F as z,x as g,M as ee,y as te,z as le,A as oe,B as se,p as re,v as ae}from"./.pnpm-DVFgL_l4.js";import{u as ne}from"./fileListStore-CWpzv-iE.js";import{u as ie,a as ue,g as h,c as de}from"./index-C61Nv7a3.js";import{c as pe}from"./copy-ZJ2NYpOM.js";import{f as me}from"./format-DaCfCw6f.js";import{i as ce}from"./isMobile-BD0f7XPI.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ge=["src"],ve=K({__name:"GetFileList",setup(_e){const L=E("right");ce()&&(L.value="top");const v=ne(),{pending:D,getFileListForm:o,getFileListFormRef:V,selectedRows:N,limitForm:w,limitMessage:b,vcode:_,downloadLinks:T}=U(v),$=ie(),{config:d}=U($),Z=(l,t,n)=>t===""?n(new Error("请先输入需要解析的链接")):F(t)?n():n(new Error("请输入合法的链接")),I=()=>{o.value.dir="/",o.value.surl="";const l=F(o.value.url);l&&(l.id&&(l.surl?(o.value.url=`https://pan.baidu.com/share/init?surl=${l.id}`,o.value.surl=`1${l.id}`):(o.value.url=`https://pan.baidu.com/s/${l.id}`,o.value.surl=l.id)),l.pwd&&(o.value.pwd=l.pwd,A.success("已自动填写密码")))},F=l=>{const t=l.match(/s\/([a-zA-Z0-9_-]+)/),n=l.match(/surl=([a-zA-Z0-9_-]+)/),m=l.match(/\?pwd=([a-zA-Z0-9_-]+)/),u=l.match(/&pwd=([a-zA-Z0-9_-]+)/),c=l.match(/提取码:\s?([a-zA-Z0-9_-]+)/);let y;if(n)y=n[1];else if(t)y=t[1];else return!1;const k=m?m[1]:u?u[1]:c?c[1]:null;return n?{surl:!0,id:y,pwd:k}:{id:y,pwd:k}},G={url:[{required:!0,validator:Z,trigger:"blur"}]},P=async l=>{if(!l||!await l.validate())return;const t=new URLSearchParams;t.set("url",o.value.url),t.set("surl",o.value.surl),t.set("pwd",o.value.pwd),t.set("dir",o.value.dir),pe(`${location.host}/?${t.toString()}`,"复制成功")};O(()=>{Q(()=>{const l=new URLSearchParams(location.search);l.size<4||(o.value={url:l.get("url")??"",pwd:l.get("pwd")??"",dir:l.get("dir")??"/",surl:l.get("surl")??""},A.success("已读取到参数,正在加载"),setTimeout(v.getFileList,1e3))}),v.getLimit(),S()});const C=W(),q=()=>C.push("/login"),J=()=>C.push("/admin"),j=l=>window.open(l),M=E(0),S=()=>M.value=Date.now(),B=()=>T.value=[];return(l,t)=>{const n=ee,m=te,u=le,c=oe,y=se,k=re,H=ae;return X((i(),p(k,null,{default:a(()=>[x("h2",null,"前台解析中心 | "+Y(e(ue)()),1),e(d).show_copyright?(i(),p(n,{key:0,"show-icon":"",type:"warning",closable:!1,title:e(d).custom_copyright},null,8,["title"])):f("",!0),e(d).have_account?(i(),p(n,{key:1,closable:!1,class:"alert",title:`当前中转账号充足 当前省份:${e(d).prov??"未知"}`,type:"success"},null,8,["title"])):(i(),p(n,{key:2,closable:!1,class:"alert",title:`当前中转账号不足 当前省份:${e(d).prov??"未知"}`,type:"error"},null,8,["title"])),e(d).debug?(i(),p(n,{key:3,class:"alert",title:"当前网站开启了DEBUG模式,非调试请关闭!!!!",type:"error",closable:!1})):f("",!0),e(d).is_https?f("",!0):(i(),p(n,{key:4,class:"alert",title:"当前网站未开启SSL,可能出现无法请求Aria2服务器的问题",type:"error",closable:!1})),r(n,{class:"alert",type:e(b)===""?"success":"error",closable:!1,title:e(b)===""?`当前${e(o).token?"卡密":"用户组"}: ${e(w).group_name} 剩余可解析文件数: ${e(w).count} 剩余可解析大小: ${e(me)(e(w).size)} ${e(o).token?`到期时间: ${e(w).expired_at?new Date(e(w).expired_at).toLocaleString():"未知"}`:""}`:e(b)??"未知错误"},null,8,["type","title"]),r(y,{ref_key:"getFileListFormRef",ref:V,model:e(o),rules:G,"label-width":"auto",class:"form","label-position":L.value},{default:a(()=>[r(u,{label:"链接",prop:"url"},{default:a(()=>[r(m,{modelValue:e(o).url,"onUpdate:modelValue":t[0]||(t[0]=s=>e(o).url=s),modelModifiers:{trim:!0},onChange:t[1]||(t[1]=s=>B()),onBlur:t[2]||(t[2]=s=>I())},null,8,["modelValue"])]),_:1}),r(u,{label:"密码",prop:"pwd"},{default:a(()=>[r(m,{modelValue:e(o).pwd,"onUpdate:modelValue":t[3]||(t[3]=s=>e(o).pwd=s),modelModifiers:{trim:!0},onChange:t[4]||(t[4]=s=>B())},null,8,["modelValue"])]),_:1}),e(d).need_password?(i(),p(u,{key:0,label:"解析密码",prop:"password"},{default:a(()=>[r(m,{modelValue:e(o).password,"onUpdate:modelValue":t[5]||(t[5]=s=>e(o).password=s),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1})):f("",!0),e(d).token_mode?(i(),p(u,{key:1,label:"卡密(不用留空即可)",prop:"token"},{default:a(()=>[r(m,{modelValue:e(o).token,"onUpdate:modelValue":t[6]||(t[6]=s=>e(o).token=s),modelModifiers:{trim:!0},onBlur:e(v).getLimit},null,8,["modelValue","onBlur"])]),_:1})):f("",!0),r(u,{label:"当前路径",prop:"dir"},{default:a(()=>[r(m,{modelValue:e(o).dir,"onUpdate:modelValue":t[7]||(t[7]=s=>e(o).dir=s),disabled:""},null,8,["modelValue"])]),_:1}),e(_).hit_captcha?(i(),R(z,{key:2},[r(u,{label:"验证码编号",prop:"vcode_str"},{default:a(()=>[r(m,{modelValue:e(_).vcode_str,"onUpdate:modelValue":t[8]||(t[8]=s=>e(_).vcode_str=s),disabled:""},null,8,["modelValue"])]),_:1}),r(u,{label:"验证码图片",prop:"vcode_img"},{default:a(()=>[x("img",{src:`${e(_).vcode_img}&t=${M.value}`,alt:"验证码图片",onClick:S},null,8,ge)]),_:1}),r(u,{label:"验证码字符",prop:"vcode_input"},{default:a(()=>[r(m,{modelValue:e(_).vcode_input,"onUpdate:modelValue":t[9]||(t[9]=s=>e(_).vcode_input=s)},null,8,["modelValue"])]),_:1})],64)):f("",!0),r(u,{label:" ",class:"buttons"},{default:a(()=>[r(c,{type:"primary",onClick:t[10]||(t[10]=s=>e(v).getFileList())},{default:a(()=>[g("获取/刷新列表")]),_:1}),r(c,{type:"primary",disabled:e(N).length<=0,onClick:t[11]||(t[11]=s=>e(v).getDownloadLinks())},{default:a(()=>[g(" 批量解析 ")]),_:1},8,["disabled"]),r(c,{type:"primary",onClick:t[12]||(t[12]=s=>P(e(V)))},{default:a(()=>[g("复制当前地址")]),_:1}),e(d).button_link!==""?(i(),p(c,{key:0,type:"primary",onClick:t[13]||(t[13]=s=>j(e(d).button_link))},{default:a(()=>[g(" 前往购买卡密 ")]),_:1})):f("",!0),e(h)()==="0"?(i(),p(c,{key:1,type:"primary",onClick:t[14]||(t[14]=s=>q())},{default:a(()=>[g("登陆")]),_:1})):f("",!0),e(h)()==="1"?(i(),R(z,{key:2},[e(de)()==="admin"?(i(),p(c,{key:0,type:"primary",onClick:t[15]||(t[15]=s=>J())},{default:a(()=>[g(" 进入后台 ")]),_:1})):f("",!0),r(c,{type:"danger",onClick:t[16]||(t[16]=s=>e($).logout())},{default:a(()=>[g(" 注销 ")]),_:1})],64)):f("",!0)]),_:1})]),_:1},8,["model","label-position"])]),_:1})),[[H,e(D)]])}}}),Fe=fe(ve,[["__scopeId","data-v-523f1bd2"]]);export{Fe as default};
