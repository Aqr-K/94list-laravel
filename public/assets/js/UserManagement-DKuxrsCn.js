import"./base-DzfnSdGl.js";import{v as T}from"./el-loading-Dqc-yn7H.js";import{E as Y}from"./el-pagination-DwvF7Wex.js";import{E as q}from"./el-input-BEQYXOrs.js";import"./el-tag-CUh0AjBU.js";import{E as G,a as K}from"./el-select-CZZ_1tAL.js";import{E as Z,a as h}from"./el-table-column-BcnOE-AB.js";import{E as j}from"./el-button-DtYNY52B.js";import{aa as S,d as H,aK as ee,aL as ae,r as f,o as V,e as w,f as l,a,k as _,w as c,c as A,F as N,aE as J,E as M,O as le,i as D,t as $,a4 as U,n as R}from"./index-niWMSR8p.js";import{E as te}from"./el-overlay-3YP-gJF7.js";import{E as oe,a as se}from"./el-form-item-Ct3QjCMy.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-Bbp7VP7R.js";import"./use-form-item-DsYTp4Yb.js";import"./focus-trap-CVuM4905.js";import"./AdminView-Cgf6NGdE.js";import"./el-card-D0AZMfBh.js";import"./user-Cd5hS_vJ.js";import"./vnode-CSQD_1u2.js";import"./scroll-DGkImYz_.js";const de=d=>S.post("/admin/user",d),ue=d=>S.get(`/admin/user?page=${d.page}&size=${d.size}`),re=d=>S.patch(`/admin/user/${d.id}`,d),ie=d=>S.delete("/admin/user",{data:{user_ids:[d.id]}}),pe=d=>S.delete("/admin/user/switch",{data:{user_ids:d}}),me=H({__name:"AddUser",props:{modelValue:{},modelModifiers:{}},emits:ee(["getUsers"],["update:modelValue"]),setup(d,{emit:p}){const k=p,y=ae(d,"modelValue"),b=f(!1),u=f({username:"",password:"",role:"user",group_id:void 0}),m=f(null),x={username:[{required:!0,message:"请输入账户用户名",trigger:"blur"}],password:[{required:!0,message:"请输入账户密码",trigger:"blur"}]},F=async E=>{if(!(!E||!await E.validate()))try{b.value=!0,await de(u.value),M.success("添加成功")}finally{b.value=!1}},I=E=>{k("getUsers"),E()},L=()=>{y.value=!1,k("getUsers")};return(E,s)=>{const v=q,C=oe,t=G,n=K,g=se,i=j,z=te,B=T;return V(),w(z,{title:"添加用户",width:"60%",modelValue:y.value,"onUpdate:modelValue":s[6]||(s[6]=o=>y.value=o),"before-close":I},{footer:l(()=>[a(i,{type:"info",onClick:s[4]||(s[4]=o=>L())},{default:l(()=>[_("取消")]),_:1}),a(i,{type:"primary",onClick:s[5]||(s[5]=o=>F(m.value))},{default:l(()=>[_("添加")]),_:1})]),default:l(()=>[c((V(),w(g,{ref_key:"addUserFormRef",ref:m,model:u.value,rules:x,"label-width":"auto"},{default:l(()=>[a(C,{label:"用户名",prop:"username"},{default:l(()=>[a(v,{modelValue:u.value.username,"onUpdate:modelValue":s[0]||(s[0]=o=>u.value.username=o)},null,8,["modelValue"])]),_:1}),a(C,{label:"密码",prop:"password"},{default:l(()=>[a(v,{modelValue:u.value.password,"onUpdate:modelValue":s[1]||(s[1]=o=>u.value.password=o)},null,8,["modelValue"])]),_:1}),a(C,{label:"权限",prop:"role"},{default:l(()=>[a(n,{modelValue:u.value.role,"onUpdate:modelValue":s[2]||(s[2]=o=>u.value.role=o)},{default:l(()=>[(V(),A(N,null,J(["user","admin"],o=>a(t,{key:o,label:o,value:o},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(C,{label:"用户组ID",prop:"group_id"},{default:l(()=>[a(v,{modelValue:u.value.group_id,"onUpdate:modelValue":s[3]||(s[3]=o=>u.value.group_id=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[B,b.value]])]),_:1},8,["modelValue"])}}}),ce=H({__name:"UserManagement",setup(d){const p=f(!1),k=f(15),y=f(1),b=f(),u=f([]),m=async()=>{try{p.value=!0;const t=await ue({page:y.value,size:k.value});b.value=t.data}finally{p.value=!1}},x=async t=>{t.edit=!(t.edit??!1)},F=async t=>{t.edit=!(t.edit??!0),await I(t)},I=async t=>{try{p.value=!0,await re(t),M.success("修改用户成功")}finally{p.value=!1,await m()}},L=async t=>{try{p.value=!0,await ie(t),M.success("删除用户成功")}finally{p.value=!1,await m()}},E=async()=>{try{p.value=!0;const t=u.value.map(n=>n.id);await pe(t),M.success("批量删除用户成功")}finally{p.value=!1,await m()}},s=t=>u.value=t;le(m);const v=f(!1),C=()=>v.value=!v.value;return(t,n)=>{var O,P;const g=j,i=Z,z=q,B=G,o=K,Q=h,W=Y,X=T;return V(),A(N,null,[a(me,{onGetUsers:m,modelValue:v.value,"onUpdate:modelValue":n[0]||(n[0]=e=>v.value=e)},null,8,["modelValue"]),a(g,{type:"primary",onClick:n[1]||(n[1]=e=>m())},{default:l(()=>[_("刷新列表")]),_:1}),a(g,{type:"primary",onClick:n[2]||(n[2]=e=>C())},{default:l(()=>[_("添加用户")]),_:1}),a(g,{type:"danger",disabled:u.value.length<=0,onClick:n[3]||(n[3]=e=>E())},{default:l(()=>[_(" 批量删除 ")]),_:1},8,["disabled"]),c((V(),w(Q,{data:((O=b.value)==null?void 0:O.data)??[],border:"","show-overflow-tooltip":"",class:"table",onSelectionChange:s},{default:l(()=>[a(i,{type:"selection",width:"40"}),a(i,{prop:"id",label:"ID"}),a(i,{prop:"group_id",label:"用户组ID"},{default:l(({row:e})=>[c(D("span",null,$(e.group_id),513),[[U,!e.edit]]),c(a(z,{modelValue:e.group_id,"onUpdate:modelValue":r=>e.group_id=r},null,8,["modelValue","onUpdate:modelValue"]),[[U,e.edit]])]),_:1}),a(i,{prop:"inv_code_id",label:"邀请码ID"}),a(i,{prop:"username",label:"用户名"},{default:l(({row:e})=>[c(D("span",null,$(e.username),513),[[U,!e.edit]]),c(a(z,{modelValue:e.username,"onUpdate:modelValue":r=>e.username=r},null,8,["modelValue","onUpdate:modelValue"]),[[U,e.edit]])]),_:1}),a(i,{prop:"password",label:"密码"},{default:l(({row:e})=>[c(D("span",null,$(e.password),513),[[U,!e.edit]]),c(a(z,{modelValue:e.password,"onUpdate:modelValue":r=>e.password=r},null,8,["modelValue","onUpdate:modelValue"]),[[U,e.edit]])]),_:1}),a(i,{prop:"role",label:"权限"},{default:l(({row:e})=>[c(D("span",null,$(e.role),513),[[U,!e.edit]]),c(a(o,{modelValue:e.role,"onUpdate:modelValue":r=>e.role=r},{default:l(()=>[(V(),A(N,null,J(["user","admin"],r=>a(B,{key:r,label:r,value:r},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"]),[[U,e.edit]])]),_:1}),a(i,{prop:"created_at",label:"创建时间"},{default:l(({row:e})=>[_($(new Date(e.created_at).toLocaleString()),1)]),_:1}),a(i,{prop:"updated_at",label:"更新时间"},{default:l(({row:e})=>[_($(new Date(e.updated_at).toLocaleString()),1)]),_:1}),a(i,{width:"150",label:"操作",fixed:"right"},{default:l(({row:e})=>[e.edit?R("",!0):(V(),w(g,{key:0,size:"small",type:"primary",onClick:r=>x(e)},{default:l(()=>[_(" 编辑 ")]),_:2},1032,["onClick"])),e.edit?(V(),w(g,{key:1,size:"small",type:"primary",onClick:r=>F(e)},{default:l(()=>[_(" 保存 ")]),_:2},1032,["onClick"])):R("",!0),a(g,{size:"small",type:"danger",onClick:r=>L(e)},{default:l(()=>[_("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[X,p.value]]),a(W,{"current-page":y.value,"onUpdate:currentPage":n[4]||(n[4]=e=>y.value=e),"page-size":k.value,"onUpdate:pageSize":n[5]||(n[5]=e=>k.value=e),"page-sizes":[15,30,50,100],total:((P=b.value)==null?void 0:P.total)??100,layout:"sizes, prev, pager, next",onSizeChange:m,onCurrentChange:m},null,8,["current-page","page-size","total"])],64)}}}),Le=ne(ce,[["__scopeId","data-v-03d19aad"]]);export{Le as default};
